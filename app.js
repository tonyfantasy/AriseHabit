(function () {
  'use strict';

  const STORAGE_KEY = 'habit-tracker-data';
  const NOTIFICATION_KEY = 'habit-tracker-notifications';
  const WELLNESS_NOTIFY_KEY = 'habit-tracker-wellness-sent';
  const MENTAL_STORAGE_KEY = 'habit-tracker-mental';
  const CHARACTER_KEY = 'habit-tracker-character';

  let chart = null;
  let notificationCheckInterval = null;
  const notifiedToday = {};

  // –í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è ¬´—Å–æ–≤–µ—Ç–Ω–∏–∫¬ª —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø—Ä–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å)
  const WELLNESS_CHECK_TIMES = ['10:00', '14:00', '18:00'];
  const WELLNESS_MESSAGES = [
    '–ö–∞–∫ –≤—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ? –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞–∑–¥–µ–ª ¬´–ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ¬ª –∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.',
    '–ú–∏–Ω—É—Ç–∫–∞ –¥–ª—è —Å–µ–±—è: –∫–∞–∫ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å —Å—Ç—Ä–µ—Å—Å–∞ —Å–µ–π—á–∞—Å? –ó–∞–≥–ª—è–Ω–∏—Ç–µ –≤ ¬´–ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ¬ª.',
    '–ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞: –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ? –°–æ–≤–µ—Ç–Ω–∏–∫ –∂–¥—ë—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ ¬´–ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ¬ª.'
  ];

  const state = {
    habits: [],
    completions: {},
    notificationsEnabled: false,
    mental: { step: 'welcome', mood: null, factor: null, messages: [] },
    character: null
  };

  // WHY: Config-driven XP/levels/achievements for tuning without code changes (see game-config.js).
  var XP_PER_HABIT_FULL = (typeof AriseConfig !== 'undefined' && AriseConfig.getBaseXpPerHabit) ? AriseConfig.getBaseXpPerHabit() : 15;
  var XP_LEVELS = (typeof AriseConfig !== 'undefined' && AriseConfig.getLevelCurve) ? AriseConfig.getLevelCurve() : [0, 100, 250, 450, 700, 1000, 1400, 1900, 2500, 3200, 4000];
  var ACHIEVEMENTS_LIST = (typeof AriseConfig !== 'undefined' && AriseConfig.GAME_CONFIG && AriseConfig.GAME_CONFIG.achievements) ? AriseConfig.GAME_CONFIG.achievements : [
    { id: 'first_steps', name: '–ü–µ—Ä–≤—ã–π –±–æ–π', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–≤—ã–π –∫–≤–µ—Å—Ç –≤ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–∏', icon: '‚öîÔ∏è', tier: 'bronze' },
    { id: 'streak_3', name: '–°–µ—Ä–∏—è —Ö3', desc: '3 –¥–Ω—è –ø–æ–¥—Ä—è–¥ –±–µ–∑ –ø–µ—Ä–µ—Ä—ã–≤–∞ ‚Äî –æ–≥–æ–Ω—å –Ω–µ –≥–∞—Å–Ω–µ—Ç', icon: 'üî•', tier: 'bronze' },
    { id: 'streak_7', name: '–ù–µ–¥–µ–ª—è –≤ –æ–≥–Ω–µ', desc: '7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥. –ù–∞—Å—Ç–æ—è—â–∞—è —Å–µ—Ä–∏—è.', icon: 'üíé', tier: 'silver' },
    { id: 'full_day', name: '–ò–¥–µ–∞–ª—å–Ω—ã–π —Ä–∞—É–Ω–¥', desc: '–í—Å–µ –∫–≤–µ—Å—Ç—ã –¥–Ω—è –Ω–∞ 100% ‚Äî –±–µ–∑ –µ–¥–∏–Ω–æ–≥–æ –ø—Ä–æ–º–∞—Ö–∞', icon: 'üëë', tier: 'gold' },
    { id: 'level_5', name: '–£—Ä–æ–≤–µ–Ω—å 5', desc: '–î–æ—Å—Ç–∏–≥–Ω—É—Ç 5-–π —É—Ä–æ–≤–µ–Ω—å. –†–æ—Å—Ç —Å–∏–ª—ã –≤–∏–¥–µ–Ω.', icon: '‚¨ÜÔ∏è', tier: 'silver' },
    { id: 'week_one', name: '–ù–µ–¥–µ–ª—è –≤ –¥–µ–ª–µ', desc: '7 –¥–Ω–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é ‚Äî –ø—Ä–∏–≤—ã—á–∫–∞ –∑–∞–∫—Ä–µ–ø–ª—è–µ—Ç—Å—è', icon: 'üó°Ô∏è', tier: 'bronze' },
    { id: 'early_bird', name: '–†–∞–Ω–Ω—è—è –ø—Ç–∞—à–∫–∞', desc: '–ö–≤–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –¥–æ 10:00. –£—Ç—Ä–æ —Ç–≤–æ—ë.', icon: 'üåÖ', tier: 'silver' },
    { id: 'ten_quests', name: '–ú–∞—Å—Ç–µ—Ä –∫–≤–µ—Å—Ç–æ–≤', desc: '10 –∫–≤–µ—Å—Ç–æ–≤ –∑–∞ –æ–¥–∏–Ω –¥–µ–Ω—å ‚Äî —Ä–µ–∫–æ—Ä–¥–Ω—ã–π –∑–∞–±–µ–≥', icon: 'üéØ', tier: 'gold' }
  ];

  // –ë–∞–∑–∞ —Å–æ–≤–µ—Ç–æ–≤ –æ—Ç —ç–∫—Å–ø–µ—Ä—Ç–æ–≤ (–ö–ü–¢, –≥–∏–≥–∏–µ–Ω–∞ —Å–Ω–∞, –º–∞–π–Ω–¥—Ñ—É–ª–Ω–µ—Å—Å, —Ä–µ–≥—É–ª—è—Ü–∏—è —Å—Ç—Ä–µ—Å—Å–∞). –ü–æ–¥–±–æ—Ä –ø–æ —Ñ–∞–∫—Ç–æ—Ä—É –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—é.
  const MENTAL_TIPS = {
    stress: [
      '–î—ã—Ö–∞–Ω–∏–µ 4-4-6: –≤–¥–æ—Ö 4 —Å—á—ë—Ç–∞, –∑–∞–¥–µ—Ä–∂–∫–∞ 4, –≤—ã–¥–æ—Ö 6. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø–∞—Ä–∞—Å–∏–º–ø–∞—Ç–∏–∫—É –∏ —Å–Ω–∏–∂–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –í–û–ó).',
      '–í—ã–π–¥–∏—Ç–µ –Ω–∞ 5 –º–∏–Ω—É—Ç –Ω–∞ —É–ª–∏—Ü—É –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –æ–∫–Ω–æ. –°–≤–µ–∂–∏–π –≤–æ–∑–¥—É—Ö –∏ —Å–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å–Ω–∏–∂–∞—é—Ç –∫–æ—Ä—Ç–∏–∑–æ–ª.',
      '–ó–∞–ø–∏—à–∏—Ç–µ —Ç—Ä–∏ –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω—ã —Å–µ–≥–æ–¥–Ω—è. –°–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å —Å —É–≥—Ä–æ–∑—ã –Ω–∞ –æ–ø–æ—Ä—É (–ø—Ä–∞–∫—Ç–∏–∫–∞ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏–∏).',
      '–ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏—è: –Ω–∞–ø—Ä—è–≥–∏—Ç–µ –º—ã—à—Ü—ã —Å—Ç–æ–ø 5 —Å–µ–∫ ‚Äî —Ä–∞—Å—Å–ª–∞–±—å—Ç–µ. –ü–æ–¥–Ω–∏–º–∏—Ç–µ—Å—å –≤—ã—à–µ: –∏–∫—Ä—ã, –±—ë–¥—Ä–∞, –∂–∏–≤–æ—Ç, —Ä—É–∫–∏, –ª–∏—Ü–æ. –°–Ω–∏–º–∞–µ—Ç –º—ã—à–µ—á–Ω—ã–µ –∑–∞–∂–∏–º—ã.',
      '¬´–ó–∞–∑–µ–º–ª–µ–Ω–∏–µ¬ª 5-4-3-2-1: –Ω–∞–∑–æ–≤–∏—Ç–µ 5 –≤–µ—â–µ–π, —á—Ç–æ –≤–∏–¥–∏—Ç–µ, 4 ‚Äî —Å–ª—ã—à–∏—Ç–µ, 3 ‚Äî —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Ç–µ–ª–æ–º, 2 ‚Äî –∑–∞–ø–∞—Ö–∞, 1 ‚Äî –≤–∫—É—Å–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ ¬´–∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å¬ª.',
      '–û—Ç–ª–æ–∂–∏—Ç–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ 10 –º–∏–Ω—É—Ç. –ß–∞—Å—Ç–æ –ø–∏–∫ —Å—Ç—Ä–µ—Å—Å–∞ —Å–ø–∞–¥–∞–µ—Ç, –∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø—Ä–æ—â–µ.',
      '–ù–∞–ø–∏—à–∏—Ç–µ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏: ¬´–Ø —á—É–≤—Å—Ç–≤—É—é‚Ä¶¬ª –ù–∞–∑–≤–∞—Ç—å —ç–º–æ—Ü–∏—é —Å–Ω–∏–∂–∞–µ—Ç –µ—ë –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å (—ç—Ç–∏–∫–µ—Ç–∫–∞ —ç–º–æ—Ü–∏–π –≤ –ö–ü–¢).',
      '–ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ –≤ —Ç–µ–º–ø–µ ¬´—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–º –≥–æ–ª–æ—Å–æ–º¬ª ‚Äî 10‚Äì15 –º–∏–Ω. –î–≤–∏–∂–µ–Ω–∏–µ –ø–æ–º–æ–≥–∞–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –∞–¥—Ä–µ–Ω–∞–ª–∏–Ω.',
      '–•–æ–ª–æ–¥–Ω–∞—è –≤–æ–¥–∞: —É–º–æ–π—Ç–µ—Å—å –∏–ª–∏ –ø–æ–¥–µ—Ä–∂–∏—Ç–µ —Ä—É–∫–∏ –ø–æ–¥ —Ö–æ–ª–æ–¥–Ω–æ–π –≤–æ–¥–æ–π. –¢—Ä–∏–≥–≥–µ—Ä —Ä–µ—Ñ–ª–µ–∫—Å–∞ –Ω—ã—Ä—è–Ω–∏—è —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç.',
      '–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ —Å–æ—Ü—Å–µ—Ç–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–≥–∏–µ–Ω–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ñ–æ–Ω–æ–≤—É—é —Ç—Ä–µ–≤–æ–≥—É.',
      '–í—ã–¥–µ–ª–∏—Ç–µ ¬´–≤—Ä–µ–º—è –¥–ª—è –±–µ—Å–ø–æ–∫–æ–π—Å—Ç–≤–∞¬ª: 15 –º–∏–Ω—É—Ç –≤–µ—á–µ—Ä–æ–º –∑–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ —Ç—Ä–µ–≤–æ–≥–∏ –∏ –≤–æ–∑–º–æ–∂–Ω—ã–µ —à–∞–≥–∏. –í –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ –º—ã—Å–ª–∏ –¥–æ —ç—Ç–æ–≥–æ –æ–∫–Ω–∞.',
      '–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–¥–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É, —Å –∫–µ–º –º–æ–∂–Ω–æ —á–µ—Å—Ç–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è. –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ‚Äî –±—É—Ñ–µ—Ä –æ—Ç —Å—Ç—Ä–µ—Å—Å–∞.',
      '–°–¥–µ–ª–∞–π—Ç–µ –æ–¥–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–µ–ª. –ß—É–≤—Å—Ç–≤–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–Ω–∏–∂–∞–µ—Ç –±–µ—Å–ø–æ–º–æ—â–Ω–æ—Å—Ç—å.',
      '–ü—Ä–æ—Å–ª—É—à–∞–π—Ç–µ –æ–¥–Ω—É —Å–ø–æ–∫–æ–π–Ω—É—é –ø–µ—Å–Ω—é —Å –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞, –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—è—Å—å. –ö–æ—Ä–æ—Ç–∫–∞—è –º—É–∑—ã–∫–∞–ª—å–Ω–∞—è –ø–∞—É–∑–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ñ–æ–∫—É—Å.',
      '–°–∫–∞–∂–∏—Ç–µ –≤—Å–ª—É—Ö: ¬´–°–µ–π—á–∞—Å —è –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏¬ª. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ 2‚Äì3 —Ä–∞–∑–∞. –ü–æ–º–æ–≥–∞–µ—Ç –≤—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ ¬´—É–≥—Ä–æ–∑—ã¬ª.'
    ],
    sleep: [
      '–ó–∞ —á–∞—Å –¥–æ —Å–Ω–∞ —É–±–µ—Ä–∏—Ç–µ —ç–∫—Ä–∞–Ω—ã –∏ –ø—Ä–∏–≥–ª—É—à–∏—Ç–µ —Å–≤–µ—Ç. –°–∏–Ω–∏–π —Å–≤–µ—Ç –ø–æ–¥–∞–≤–ª—è–µ—Ç –º–µ–ª–∞—Ç–æ–Ω–∏–Ω (–≥–∏–≥–∏–µ–Ω–∞ —Å–Ω–∞, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å–æ–º–Ω–æ–ª–æ–≥–æ–≤).',
      '–û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ ¬´—è–∫–æ—Ä—å —Å–Ω–∞¬ª –∫–∞–∂–¥—ã–π –≤–µ—á–µ—Ä: —É–º—ã–≤–∞–Ω–∏–µ, —á–∞–π –±–µ–∑ –∫–æ—Ñ–µ–∏–Ω–∞, 5 –º–∏–Ω—É—Ç —Ç–∏—à–∏–Ω—ã. –†–∏—Ç—É–∞–ª –¥–∞—ë—Ç –º–æ–∑–≥—É —Å–∏–≥–Ω–∞–ª –∫–æ —Å–Ω—É.',
      '–ï—Å–ª–∏ –º—ã—Å–ª–∏ –∫—Ä—É—Ç—è—Ç—Å—è ‚Äî –∑–∞–ø–∏—à–∏—Ç–µ –∏—Ö –Ω–∞ –±—É–º–∞–≥—É –∏ –æ—Ç–ª–æ–∂–∏—Ç–µ –¥–æ —É—Ç—Ä–∞. ¬´–í—ã–≥—Ä—É–∑–∫–∞¬ª —É–º–µ–Ω—å—à–∞–µ—Ç –Ω–∞–≤—è–∑—á–∏–≤–æ–µ –æ–±–¥—É–º—ã–≤–∞–Ω–∏–µ.',
      '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ —Å–ø–∞–ª—å–Ω–µ 18‚Äì20 ¬∞C. –ü—Ä–æ—Ö–ª–∞–¥–∞ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –∑–∞—Å—ã–ø–∞–Ω–∏—é.',
      '–ù–µ –ª–µ–∂–∏—Ç–µ –≤ –∫—Ä–æ–≤–∞—Ç–∏ –±–æ–ª—å—à–µ 20 –º–∏–Ω—É—Ç –±–µ–∑ —Å–Ω–∞. –í—Å—Ç–∞–Ω—å—Ç–µ, –∑–∞–π–º–∏—Ç–µ—Å—å —Å–ø–æ–∫–æ–π–Ω—ã–º –¥–µ–ª–æ–º –ø—Ä–∏ –ø—Ä–∏–≥–ª—É—à—ë–Ω–Ω–æ–º —Å–≤–µ—Ç–µ, –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –∫—Ä–æ–≤–∞—Ç—å –∫–æ–≥–¥–∞ –∑–∞—Ö–æ—á–µ—Ç—Å—è —Å–ø–∞—Ç—å.',
      '–ö–æ—Ñ–µ–∏–Ω: –ø–æ—Å–ª–µ–¥–Ω—è—è —á–∞—à–∫–∞ –Ω–µ –ø–æ–∑–∂–µ —á–µ–º –∑–∞ 6‚Äì8 —á–∞—Å–æ–≤ –¥–æ —Å–Ω–∞. –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —á–∞–π –∏ –∫–æ–ª—É.',
      '–î–Ω–µ–≤–Ω–æ–π —Å–æ–Ω ‚Äî –Ω–µ –±–æ–ª–µ–µ 20‚Äì30 –º–∏–Ω—É—Ç –∏ –¥–æ 15:00, –∏–Ω–∞—á–µ —Å–¥–≤–∏–≥–∞–µ—Ç—Å—è –Ω–æ—á–Ω–æ–π —Å–æ–Ω.',
      '–£—Ç—Ä–æ–º –≤—ã—Ö–æ–¥–∏—Ç–µ –Ω–∞ —Å–≤–µ—Ç (–∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ —è—Ä–∫–∏–π —Å–≤–µ—Ç). –†–µ–≥—É–ª—è—Ä–Ω—ã–π —Å–≤–µ—Ç –ø–æ —É—Ç—Ä–∞–º —É–∫—Ä–µ–ø–ª—è–µ—Ç —Ü–∏—Ä–∫–∞–¥–Ω—ã–π —Ä–∏—Ç–º.',
      '–ü–µ—Ä–µ–¥ —Å–Ω–æ–º ‚Äî –ª—ë–≥–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ –∏–ª–∏ –¥—ã—Ö–∞–Ω–∏–µ 4-4-6 –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç. –°–Ω–∏–∂–∞–µ—Ç –º—ã—à–µ—á–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
      '–ò–∑–±–µ–≥–∞–π—Ç–µ —Ç—è–∂—ë–ª–æ–π –µ–¥—ã –∏ –∞–ª–∫–æ–≥–æ–ª—è –∑–∞ 2‚Äì3 —á–∞—Å–∞ –¥–æ —Å–Ω–∞. –ò —Ç–æ –∏ –¥—Ä—É–≥–æ–µ —É—Ö—É–¥—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Å–Ω–∞.',
      '–ï—Å–ª–∏ –ø—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –Ω–æ—á—å—é ‚Äî –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ —á–∞—Å—ã. –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –≤—Ä–µ–º–µ–Ω–µ–º —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É –∏ –±–æ–¥—Ä—Å—Ç–≤–æ–≤–∞–Ω–∏–µ.',
      '–°–ø–∞–ª—å–Ω—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–Ω–∞ –∏ –±–ª–∏–∑–æ—Å—Ç–∏. –†–∞–±–æ—Ç–∞ –∏ —ç–∫—Ä–∞–Ω—ã –≤ –¥—Ä—É–≥–æ–π –∫–æ–º–Ω–∞—Ç–µ –ø–æ–º–æ–≥–∞—é—Ç —Å–≤—è–∑–∞—Ç—å –∫—Ä–æ–≤–∞—Ç—å —Å–æ —Å–Ω–æ–º.',
      '–í–µ–¥–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π ¬´—Å–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫¬ª: –≤–æ —Å–∫–æ–ª—å–∫–æ –ª–µ–≥–ª–∏, –∫–∞–∫ —Å–ø–∞–ª–æ—Å—å, –≤–æ —Å–∫–æ–ª—å–∫–æ –≤—Å—Ç–∞–ª–∏. –ü–æ–º–æ–≥–∞–µ—Ç —É–≤–∏–¥–µ—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω—ã.',
      '–ú–∞–≥–Ω–∏–π (–≤ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –∏–ª–∏ –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤—Ä–∞—á–∞) –∏ —Ç—ë–ø–ª—ã–π –¥—É—à –ø–µ—Ä–µ–¥ —Å–Ω–æ–º —Ä–∞—Å—Å–ª–∞–±–ª—è—é—Ç –º–Ω–æ–≥–∏—Ö –ª—é–¥–µ–π.',
      '–ï—Å–ª–∏ –±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞ —Å—Ç–æ–π–∫–∞—è ‚Äî –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É –∏–ª–∏ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ-–ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–æ–º—É —Ç–µ—Ä–∞–ø–µ–≤—Ç—É –ø–æ –∏–Ω—Å–æ–º–Ω–∏–∏ (–ö–ü–¢-–ò).'
    ],
    work: [
      '–û–¥–∏–Ω —à–∞–≥: –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á—É –Ω–∞ 5‚Äì15 –º–∏–Ω—É—Ç –∏ —Å–¥–µ–ª–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –µ—ë. –ü–µ—Ä–≤—ã–π —à–∞–≥ —á–∞—Å—Ç–æ —Å–Ω–∏–º–∞–µ—Ç –±–ª–æ–∫ (–ø—Ä–∏–Ω—Ü–∏–ø ¬´–º–∞–ª–µ–Ω—å–∫–∏—Ö —à–∞–≥–æ–≤¬ª).',
      '–ü–æ–º–æ–¥–æ—Ä–æ: 25 –º–∏–Ω—É—Ç —Ä–∞–±–æ—Ç—ã, 5 –º–∏–Ω—É—Ç –ø–µ—Ä–µ—Ä—ã–≤–∞. –í –ø–µ—Ä–µ—Ä—ã–≤–µ –≤—Å—Ç–∞–≤–∞–π—Ç–µ, –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç–µ –≤ —ç–∫—Ä–∞–Ω. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–æ–∫—É—Å –∏ —ç–Ω–µ—Ä–≥–∏—é.',
      '–í –∫–æ–Ω—Ü–µ –¥–Ω—è –∑–∞–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫–∏ –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–¥–Ω—É —Ñ—Ä–∞–∑—É: ¬´–ó–∞–≤—Ç—Ä–∞ –Ω–∞—á–Ω—É —Å‚Ä¶¬ª. –ß—ë—Ç–∫–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —Ñ–æ–Ω–æ–≤–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
      '–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è: –≤—ã–±–µ—Ä–∏—Ç–µ 1‚Äì3 –≥–ª–∞–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –¥–µ–Ω—å. –û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –ø–æ –æ—Å—Ç–∞—Ç–∫—É —Å–∏–ª (–ø—Ä–∞–≤–∏–ª–æ —Ç—Ä—ë—Ö).',
      '¬´–°—ä–µ—à—å—Ç–µ –ª—è–≥—É—à–∫—É¬ª: —Å–∞–º—É—é –Ω–µ–ø—Ä–∏—è—Ç–Ω—É—é –∑–∞–¥–∞—á—É —Å–¥–µ–ª–∞–π—Ç–µ –ø–µ—Ä–≤–æ–π. –°–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—é –∏ —Ç—Ä–µ–≤–æ–≥—É.',
      '–û—Ç–∫–ª—é—á–∏—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–∞ 1‚Äì2 —á–∞—Å–∞ –≤ ¬´–≥–ª—É–±–æ–∫–æ–π —Ä–∞–±–æ—Ç–µ¬ª. –ú–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å –ø–æ–≤—ã—à–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å –∏ –æ—à–∏–±–∫–∏.',
      '–ì—Ä–∞–Ω–∏—Ü—ã: –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤—Ä–µ–º—è ¬´–∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è¬ª –∏ –æ–¥–∏–Ω —Ä–∏—Ç—É–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–∑–∞–∫—Ä—ã—Ç—å –Ω–æ—É—Ç, –≤—ã–π—Ç–∏ –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞).',
      '–ú–∏–∫—Ä–æ-–ø–∞—É–∑—ã: –∫–∞–∂–¥—ã–µ 60‚Äì90 –º–∏–Ω—É—Ç –≤—Å—Ç–∞–≤–∞–π—Ç–µ, –ø–æ—Ç—è–Ω–∏—Ç–µ—Å—å, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–¥–∞–ª—å 1‚Äì2 –º–∏–Ω—É—Ç—ã. –°–Ω–∏–∂–∞–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
      '–†–∞–∑–¥–µ–ª–∏—Ç–µ –±–æ–ª—å—à—É—é –∑–∞–¥–∞—á—É –Ω–∞ –ø–æ–¥–∑–∞–¥–∞—á–∏ —Å —á—ë—Ç–∫–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä–∏—è–º–∏ ¬´—Å–¥–µ–ª–∞–Ω–æ¬ª. –ù–µ—á—ë—Ç–∫–æ—Å—Ç—å —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É.',
      '–î–µ–ª–µ–≥–∏—Ä—É–π—Ç–µ –∏–ª–∏ –æ—Ç–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ. –ó–∞—â–∏—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å–Ω–∏–∂–∞–µ—Ç –≤—ã–≥–æ—Ä–∞–Ω–∏–µ.',
      '–ó–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ –∑–∞ –¥–µ–Ω—å. –§–æ–∫—É—Å –Ω–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ–º —Å–Ω–∏–∂–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ ¬´–Ω–∏—á–µ–≥–æ –Ω–µ —É—Å–ø–µ–≤–∞—é¬ª.',
      '–†–∞–±–æ—á–µ–µ –º–µ—Å—Ç–æ: —É–±–µ—Ä–∏—Ç–µ –ª–∏—à–Ω–µ–µ —Å —ç–∫—Ä–∞–Ω–∞, –¥–æ–±–∞–≤—å—Ç–µ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –∫–æ–º—Ñ–æ—Ä—Ç–∞ (—Å–≤–µ—Ç, –ø–æ—Ä—è–¥–æ–∫). –ü–æ—Ä—è–¥–æ–∫ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É.',
      '–ï—Å–ª–∏ —Ç—É–ø–∏–∫ ‚Äî —Å–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞ 10 –º–∏–Ω—É—Ç (–ø—Ä–æ–≥—É–ª–∫–∞, —á–∞–π, –¥—Ä—É–≥–∞—è –ª—ë–≥–∫–∞—è –∑–∞–¥–∞—á–∞). –ß–∞—Å—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –æ—Ç–≤–ª–µ—á–µ–Ω–∏—è.',
      '–û–¥–∏–Ω ¬´–Ω–µ—Ç¬ª —Å–µ–≥–æ–¥–Ω—è: –æ—Ç–∫–∞–∂–∏—Ç–µ –≤ –æ–¥–Ω–æ–π –ø—Ä–æ—Å—å–±–µ, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥—Ä–∞–Ω–∏—Ü ‚Äî —á–∞—Å—Ç—å –∑–∞–±–æ—Ç—ã –æ —Å–µ–±–µ.',
      '–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –∑–∞–≤—Ç—Ä–∞ –≤–µ—á–µ—Ä–æ–º: 3 –ø—É–Ω–∫—Ç–∞ –Ω–∞ –∑–∞–≤—Ç—Ä–∞. –£—Ç—Ä–æ–º –º–æ–∑–≥ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç —Å–∏–ª—ã –Ω–∞ ¬´—Å —á–µ–≥–æ –Ω–∞—á–∞—Ç—å¬ª.'
    ],
    awareness: [
      '5-4-3-2-1: –Ω–∞–∑–æ–≤–∏—Ç–µ 5 –≤–µ—â–µ–π, —á—Ç–æ –≤–∏–¥–∏—Ç–µ, 4 ‚Äî —Å–ª—ã—à–∏—Ç–µ, 3 ‚Äî —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Ç–µ–ª–æ–º, 2 ‚Äî –∑–∞–ø–∞—Ö–∞, 1 ‚Äî –≤–∫—É—Å–∞. –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –∑–∞–∑–µ–º–ª–µ–Ω–∏—è.',
      '–ú–∏–Ω—É—Ç–∞ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –¥—ã—Ö–∞–Ω–∏–µ–º: –Ω–µ –º–µ–Ω—è–π—Ç–µ –µ–≥–æ, –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ—á–∞–π—Ç–µ –≤–¥–æ—Ö –∏ –≤—ã–¥–æ—Ö. –ú—ã—Å–ª–∏ –ø—É—Å—Ç—å –ø—Ä–∏—Ö–æ–¥—è—Ç –∏ —É—Ö–æ–¥—è—Ç (–º–∞–π–Ω–¥—Ñ—É–ª–Ω–µ—Å—Å).',
      '–û—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –ø–µ—Ä–≤—ã–π –∫—É—Å–æ–∫: –ø–µ—Ä–µ–¥ –µ–¥–æ–π –æ–¥–∏–Ω –≤–¥–æ—Ö-–≤—ã–¥–æ—Ö –∏ –æ–¥–∏–Ω –∫—É—Å–æ–∫ —Å –ø–æ–ª–Ω—ã–º –≤–Ω–∏–º–∞–Ω–∏–µ–º –∫ –≤–∫—É—Å—É –∏ —Ç–µ–∫—Å—Ç—É—Ä–µ. –ó–∞–º–µ–¥–ª—è–µ—Ç –∏ —Å–Ω–∏–∂–∞–µ—Ç –∞–≤—Ç–æ–ø–∏–ª–æ—Ç.',
      '–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ 3 –º–∏–Ω: –æ—Ç –º–∞–∫—É—à–∫–∏ –¥–æ —Å—Ç–æ–ø –∑–∞–º–µ—á–∞–π—Ç–µ –æ–±–ª–∞—Å—Ç–∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è –∏ –¥—ã—Ö–∞–Ω–∏–µ –≤ –Ω–∏—Ö. –ù–µ –º–µ–Ω—è–π—Ç–µ ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–∞–π—Ç–µ.',
      '¬´–ú—ã—Å–ª—å ‚Äî –Ω–µ —Ñ–∞–∫—Ç¬ª: –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –Ω–∞–≤—è–∑—á–∏–≤—É—é –º—ã—Å–ª—å –∏ —Å–∫–∞–∂–∏—Ç–µ: ¬´–≠—Ç–æ –º—ã—Å–ª—å. –Ø –º–æ–≥—É –Ω–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ –Ω–µ–π¬ª. –î–∏—Å—Ç–∞–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ö–ü–¢.',
      '–û–¥–Ω–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–∞—è –º–∏–Ω—É—Ç–∞ —Ö–æ–¥—å–±—ã: —á—É–≤—Å—Ç–≤—É–π—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç —Å—Ç–æ–ø —Å –ø–æ–ª–æ–º, —Ç–µ–º–ø, —Ä—É–∫–∏. –ü—Ä–æ—Å—Ç–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è –≤ –¥–≤–∏–∂–µ–Ω–∏–∏.',
      '–î–Ω–µ–≤–Ω–∏–∫ ¬´—Ç—Ä–∏ —Ö–æ—Ä–æ—à–∏—Ö –º–æ–º–µ–Ω—Ç–∞¬ª: –≤–µ—á–µ—Ä–æ–º –∑–∞–ø–∏—à–∏—Ç–µ —Ç—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–∞ –∑–∞ –¥–µ–Ω—å. –£–∫—Ä–µ–ø–ª—è–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–º—É.',
      '–ü–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º: –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–µ —Å–¥–µ–ª–∞–π—Ç–µ –æ–¥–∏–Ω –≤–¥–æ—Ö –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—Ç—å. –°–Ω–∏–∂–∞–µ—Ç —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –ø–æ–≤—ã—à–∞–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å.',
      '–û–¥–∏–Ω ¬´—è –∑–∞–º–µ—á–∞—é‚Ä¶¬ª: –≤—Å–ª—É—Ö –∏–ª–∏ –ø—Ä–æ —Å–µ–±—è –æ–ø–∏—à–∏—Ç–µ –æ–¥–Ω–æ –æ—â—É—â–µ–Ω–∏–µ (–∑–≤—É–∫, —Å–≤–µ—Ç, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞). –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ.',
      '–ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –¥–æ–±—Ä–æ—Ç—ã: –º—ã—Å–ª–µ–Ω–Ω–æ –ø–æ–∂–µ–ª–∞–π—Ç–µ —Å–µ–±–µ, –±–ª–∏–∑–∫–æ–º—É –∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è –∏ —Å–∏–ª. –†–∞—Å—à–∏—Ä—è–µ—Ç —ç–º–ø–∞—Ç–∏—é –∏ –æ–ø–æ—Ä—É.',
      '–û—Ç–ª–æ–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –Ω–∞ 30 –º–∏–Ω—É—Ç. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –∏–º–ø—É–ª—å—Å–æ–º ¬´–ø—Ä–æ–≤–µ—Ä–∏—Ç—å¬ª ‚Äî –Ω–µ –¥–µ–π—Å—Ç–≤—É–π—Ç–µ —Å—Ä–∞–∑—É. –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞.',
      '–ü–µ—Ä–µ–¥ —Å–Ω–æ–º –æ–¥–Ω–∞ —Ñ—Ä–∞–∑–∞: ¬´–°–µ–≥–æ–¥–Ω—è —è —Å–¥–µ–ª–∞–ª(–∞) –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ¬ª. –°–∞–º–æ—Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —Å–∞–º–æ–∫—Ä–∏—Ç–∏–∫—É.',
      '–£—Ç—Ä–æ–º –æ–¥–Ω–∞ –º–∏–Ω—É—Ç–∞: –ø–µ—Ä–µ–¥ –ø–æ–¥—ä—ë–º–æ–º –∑–∞–º–µ—Ç—å—Ç–µ –¥—ã—Ö–∞–Ω–∏–µ –∏ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –Ω–∞ –¥–µ–Ω—å (¬´–°–µ–≥–æ–¥–Ω—è —è –±—É–¥—É‚Ä¶¬ª). –ó–∞–¥–∞—ë—Ç —Ç–æ–Ω –¥–Ω—é.',
      '–°–ª—É—à–∞–π—Ç–µ –æ–¥–Ω—É –ø–µ—Å–Ω—é –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞ –±–µ–∑ –æ—Ç–≤–ª–µ—á–µ–Ω–∏–π. –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —É—Å—Ç–æ–π—á–∏–≤–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è.',
      '–í –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –∏–ª–∏ —Å—Ç—Ä–µ—Å—Å–µ: ¬´–ü–∞—É–∑–∞ ‚Äî –¥—ã—Ö–∞–Ω–∏–µ ‚Äî –≤—ã–±–æ—Ä –æ—Ç–≤–µ—Ç–∞¬ª. –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏.'
    ],
    other: [
      '–ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –î–≤–∏–∂–µ–Ω–∏–µ –∏ –ø—Ä–∏—Ä–æ–¥–∞/—É–ª–∏—Ü–∞ —Å–Ω–∏–∂–∞—é—Ç —Å—Ç—Ä–µ—Å—Å –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –≤–Ω–∏–º–∞–Ω–∏–µ.',
      '–ù–∞–ø—Ä—è–≥–∏—Ç–µ –≤—Å–µ –º—ã—à—Ü—ã –Ω–∞ 5 —Å–µ–∫—É–Ω–¥, –∑–∞—Ç–µ–º —Ä–∞—Å—Å–ª–∞–±—å—Ç–µ. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ 2‚Äì3 —Ä–∞–∑–∞. –ü—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Ä–µ–ª–∞–∫—Å–∞—Ü–∏—è –ø–æ –î–∂–µ–∫–æ–±—Å–æ–Ω—É.',
      '–ù–∞–ø–∏—à–∏—Ç–µ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ. –ù–∞–∑–≤–∞—Ç—å —ç–º–æ—Ü–∏—é —Å–Ω–∏–∂–∞–µ—Ç –µ—ë –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å.',
      '–í—ã–ø–µ–π—Ç–µ —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã. –û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.',
      '–ü–æ–∑–≤–æ–Ω–∏—Ç–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –æ–¥–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É. –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å ‚Äî –æ–¥–∏–Ω –∏–∑ –≥–ª–∞–≤–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.',
      '–°–¥–µ–ª–∞–π—Ç–µ –æ–¥–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –ø—Ä–∏—è—Ç–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Å–µ–±—è (—á–∞–π, –º—É–∑—ã–∫–∞, –æ–∫–Ω–æ). –ú–∏–∫—Ä–æ-–∑–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.',
      '–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏ –ª–µ–Ω—Ç—É –Ω–∞ —Å–µ–≥–æ–¥–Ω—è. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è –≥–∏–≥–∏–µ–Ω–∞ —Å–Ω–∏–∂–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫—É.',
      '–ó–∞–ø–∏—à–∏—Ç–µ –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã, –¥–∞–∂–µ –Ω–µ–∏–¥–µ–∞–ª—å–Ω—ã–π. –°–Ω–∏–∂–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ —Ç—É–ø–∏–∫–∞.',
      '–í—ã–π–¥–∏—Ç–µ –Ω–∞ —Å–≤–µ—Ç (—É–ª–∏—Ü–∞ –∏–ª–∏ —è—Ä–∫–∞—è –ª–∞–º–ø–∞). –°–≤–µ—Ç –≤–ª–∏—è–µ—Ç –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Ü–∏—Ä–∫–∞–¥–Ω—ã–π —Ä–∏—Ç–º.',
      '–õ—ë–≥–∫–∞—è —Ä–∞—Å—Ç—è–∂–∫–∞ —à–µ–∏ –∏ –ø–ª–µ—á –Ω–∞ 2‚Äì3 –º–∏–Ω—É—Ç—ã. –¢–µ–ª–æ –∏ –ø—Å–∏—Ö–∏–∫–∞ —Å–≤—è–∑–∞–Ω—ã.',
      '–°–∫–∞–∂–∏—Ç–µ –≤—Å–ª—É—Ö –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ: ¬´–°–µ–π—á–∞—Å —Å–æ –º–Ω–æ–π –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ¬ª. –ü—Ä–æ—Å—Ç–∞—è –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏—è –¥–ª—è –º–æ–º–µ–Ω—Ç–∞.',
      '–í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–∏–Ω –æ—Ç–∫–∞–∑: –æ—Ç–º–µ–Ω–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ —Ç–æ, –±–µ–∑ —á–µ–≥–æ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏—Å—å. –†–∞–∑–≥—Ä—É–∑–∫–∞ –¥–Ω—è.',
      '–û–¥–∏–Ω –≤–¥–æ—Ö –Ω–∞ 4 —Å—á—ë—Ç–∞ –∏ –≤—ã–¥–æ—Ö –Ω–∞ 6. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ 5 —Ä–∞–∑. –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â—É—é —Å–∏—Å—Ç–µ–º—É.',
      '–ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–≥–æ –Ω–µ —É–ª—É—á—à–∞–µ—Ç—Å—è ‚Äî —Å—Ç–æ–∏—Ç –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –ø—Å–∏—Ö–æ–ª–æ–≥—É –∏–ª–∏ –≤—Ä–∞—á—É. –ü—Ä–æ—Å—å–±–∞ –æ –ø–æ–º–æ—â–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–∞.'
    ],
    lowMood: [
      '–°–µ–π—á–∞—Å –≤–∞–∂–Ω–æ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –æ—Ç —Å–µ–±—è –º–Ω–æ–≥–æ–≥–æ. –û–¥–∏–Ω –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ ‚Äî —É–∂–µ –ø–æ–±–µ–¥–∞.',
      '–í—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –Ω–∞ –æ—Ç–¥—ã—Ö. –î–∞–∂–µ 10 –º–∏–Ω—É—Ç —Ç–∏—à–∏–Ω—ã –∏–ª–∏ —Å–ø–æ–∫–æ–π–Ω–æ–≥–æ –¥—ã—Ö–∞–Ω–∏—è –∏–º–µ—é—Ç –∑–Ω–∞—á–µ–Ω–∏–µ.',
      '–¢–æ, —á—Ç–æ –≤—ã –∑–¥–µ—Å—å –∏ –∏—â–µ—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É ‚Äî —É–∂–µ –ø—Ä–∏–∑–Ω–∞–∫ –∑–∞–±–æ—Ç—ã –æ —Å–µ–±–µ. –≠—Ç–æ —Ü–µ–Ω–Ω–æ.',
      '–≠–º–æ—Ü–∏–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –≤–æ–ª–Ω–∞–º–∏. –≠—Ç–∞ –≤–æ–ª–Ω–∞ —Ç–æ–∂–µ –æ—Ç—Å—Ç—É–ø–∏—Ç. –î–µ—Ä–∂–∏—Ç–µ—Å—å.',
      '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∫–∞–∑–∞—Ç—å —Å–µ–±–µ: ¬´–ú–Ω–µ —Ç—è–∂–µ–ª–æ, –∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –Ø –¥–µ–ª–∞—é —á—Ç–æ –º–æ–≥—É¬ª.',
      '–ù–µ –Ω—É–∂–Ω–æ —Ä–µ—à–∞—Ç—å –≤—Å—ë —Å–µ–≥–æ–¥–Ω—è. –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –∏–ª–∏ –æ—Ç–¥—ã—Ö–∞.',
      '–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Å–∏—Ö–æ–ª–æ–≥—É –∏–ª–∏ –≤—Ä–∞—á—É ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –∏ —Å–∏–ª—å–Ω—ã–π —à–∞–≥, –µ—Å–ª–∏ —Ç—è–∂–µ–ª–æ –¥–æ–ª–≥–æ.'
    ],
    general: [
      '–ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–º–æ–≥–∞–µ—Ç ¬´–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å¬ª –≥–æ–ª–æ–≤—É –∏ —Å–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å.',
      '–ù–∞–ø—Ä—è–≥–∏—Ç–µ –≤—Å–µ –º—ã—à—Ü—ã –Ω–∞ 5 —Å–µ–∫—É–Ω–¥, –∑–∞—Ç–µ–º —Ä–∞—Å—Å–ª–∞–±—å—Ç–µ. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ 2‚Äì3 —Ä–∞–∑–∞ ‚Äî —Ç–µ–ª–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∑–∞–∂–∏–º—ã.',
      '–ù–∞–ø–∏—à–∏—Ç–µ –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏, —á—Ç–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å. –ù–∞–∑–≤–∞—Ç—å —ç–º–æ—Ü–∏—é —É–∂–µ —Å–Ω–∏–∂–∞–µ—Ç –µ—ë –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å.',
      '–î—ã—Ö–∞–Ω–∏–µ 4-4-6: –≤–¥–æ—Ö 4, –∑–∞–¥–µ—Ä–∂–∫–∞ 4, –≤—ã–¥–æ—Ö 6. –£—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.',
      '–¢—Ä–∏ –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ –±–ª–∞–≥–æ–¥–∞—Ä–Ω—ã —Å–µ–≥–æ–¥–Ω—è. –°–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å –Ω–∞ –æ–ø–æ—Ä—É.',
      '–í—ã–π–¥–∏—Ç–µ –Ω–∞ —Å–≤–µ–∂–∏–π –≤–æ–∑–¥—É—Ö –Ω–∞ 5 –º–∏–Ω—É—Ç. –°–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –∫–∏—Å–ª–æ—Ä–æ–¥ —Å–Ω–∏–∂–∞—é—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.',
      '–û–¥–∏–Ω —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã. –û–±–µ–∑–≤–æ–∂–∏–≤–∞–Ω–∏–µ —É—Å–∏–ª–∏–≤–∞–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏ —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.',
      '–ü–∞—É–∑–∞ 1 –º–∏–Ω—É—Ç–∞: –∑–∞–∫—Ä–æ–π—Ç–µ –≥–ª–∞–∑–∞, –∑–∞–º–µ—á–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥—ã—Ö–∞–Ω–∏–µ. –ú–∏–Ω–∏-–º–µ–¥–∏—Ç–∞—Ü–∏—è.',
      '–°–¥–µ–ª–∞–π—Ç–µ –æ–¥–Ω–æ –º–∞–ª–µ–Ω—å–∫–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–µ–ª. –ß—É–≤—Å—Ç–≤–æ –∫–æ–Ω—Ç—Ä–æ–ª—è —Å–Ω–∏–∂–∞–µ—Ç –±–µ—Å–ø–æ–º–æ—â–Ω–æ—Å—Ç—å.',
      '–ù–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ —Å–∫–∞–∂–∏—Ç–µ –æ–¥–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É, –∫–∞–∫ –¥–µ–ª–∞. –°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–≤—è–∑—å ‚Äî –±—É—Ñ–µ—Ä –æ—Ç —Å—Ç—Ä–µ—Å—Å–∞.'
    ]
  };

  const MENTAL_QUESTIONS = {
    mood: '–ö–∞–∫ –≤—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–≥–æ–¥–Ω—è?',
    factor: '–ß—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤–∞—à–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ?',
    guidingIntro: '–ß—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å–æ–≤–µ—Ç—ã —Ç–æ—á–Ω–µ–µ, –º–æ–≥—É —É—Ç–æ—á–Ω–∏—Ç—å –ø–∞—Ä—É –º–æ–º–µ–Ω—Ç–æ–≤. –í—ã–±–µ—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –æ—Ç–≤–µ—Ç–∏—Ç—å, –∏–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ —Å—Ä–∞–∑—É –∫ —Å–æ–≤–µ—Ç–∞–º.'
  };

  // –ù–∞–≤–æ–¥—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –∫–∞–∫ –∑–∞–¥–∞—ë—Ç —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é
  const MENTAL_GUIDING_QUESTIONS = {
    stress: [
      '–ö–∞–∫ –¥–∞–≤–Ω–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ?',
      '–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–µ–ª–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–∞—É–∑—ã –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è?',
      '–ß—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å: —Ä–∞–±–æ—Ç–∞, –æ—Ç–Ω–æ—à–µ–Ω–∏—è, –∑–¥–æ—Ä–æ–≤—å–µ –∏–ª–∏ —á—Ç–æ-—Ç–æ –µ—â—ë?',
      '–ö–∞–∫ –≤—ã –æ–±—ã—á–Ω–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º ‚Äî –µ—Å—Ç—å –ª–∏ —á—Ç–æ-—Ç–æ, —á—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç?'
    ],
    sleep: [
      '–ö–∞–∫ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Å—Ç–æ—è—Ç –¥–µ–ª–∞ —Å–æ —Å–Ω–æ–º: –∑–∞—Å—ã–ø–∞–µ—Ç–µ –ª–µ–≥–∫–æ –∏–ª–∏ –ø–æ–¥–æ–ª–≥—É –≤–æ—Ä–æ—á–∞–µ—Ç–µ—Å—å?',
      '–ü—Ä–æ—Å—ã–ø–∞–µ—Ç–µ—Å—å –ª–∏ –≤—ã –Ω–æ—á—å—é –∏–ª–∏ –ø–æ–¥ —É—Ç—Ä–æ –∏ –Ω–µ –º–æ–∂–µ—Ç–µ —É—Å–Ω—É—Ç—å?',
      '–ó–∞ —Å–∫–æ–ª—å–∫–æ –¥–æ —Å–Ω–∞ –æ–±—ã—á–Ω–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ —ç–∫—Ä–∞–Ω—ã?',
      '–ë—ã–≤–∞–µ—Ç –ª–∏, —á—Ç–æ –º—ã—Å–ª–∏ –Ω–µ –¥–∞—é—Ç —É—Å–Ω—É—Ç—å?'
    ],
    work: [
      '–ù–∞–≥—Ä—É–∑–∫–∞ —Å–µ–π—á–∞—Å –≤—ã—à–µ –æ–±—ã—á–Ω–æ–π –∏–ª–∏ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ, —á—Ç–æ –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è?',
      '–£–¥–∞—ë—Ç—Å—è –ª–∏ –æ—Ç–¥–µ–ª—è—Ç—å —Ä–∞–±–æ—Ç—É –æ—Ç –æ—Ç–¥—ã—Ö–∞ (–ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –º–µ—Å—Ç—É)?',
      '–ï—Å—Ç—å –ª–∏ –∫—Ç–æ-—Ç–æ, —Å –∫–µ–º –º–æ–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –∏–ª–∏ –æ–±—Å—É–¥–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã?',
      '–ß—Ç–æ –¥–ª—è –≤–∞—Å —Å–µ–π—á–∞—Å —Å–∞–º–æ–µ —Ç—è–∂—ë–ª–æ–µ: –æ–±—ä—ë–º –∑–∞–¥–∞—á, –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ?'
    ],
    awareness: [
      '–•–æ—Ç–∏—Ç–µ –ª–∏ –≤—ã —á–∞—â–µ –∑–∞–º–µ—á–∞—Ç—å —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è (—Ç–µ–ª–æ, –º—ã—Å–ª–∏, —ç–º–æ—Ü–∏–∏)?',
      '–ë—ã–ª –ª–∏ —É –≤–∞—Å –æ–ø—ã—Ç –º–µ–¥–∏—Ç–∞—Ü–∏–∏, –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫ –∏–ª–∏ –≤–µ–¥–µ–Ω–∏—è –¥–Ω–µ–≤–Ω–∏–∫–∞?',
      '–í –∫–∞–∫–æ–µ –≤—Ä–µ–º—è –¥–Ω—è –≤–∞–º –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –≤—ã–¥–µ–ª–∏—Ç—å 5‚Äì10 –º–∏–Ω—É—Ç –Ω–∞ —Å–µ–±—è?'
    ],
    other: [
      '–ß—Ç–æ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ –æ—Ç–Ω–∏–º–∞–µ—Ç —Å–∏–ª—ã –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?',
      '–ï—Å—Ç—å –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—è–¥–æ–º ‚Äî –ª—é–¥–∏, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?',
      '–ö–∞–∫ –¥–∞–≤–Ω–æ –≤—ã —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —Ç–∞–∫? –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?'
    ],
    general: [
      '–ö–∞–∫ –¥–∞–≤–Ω–æ –≤—ã –∑–∞–º–µ—á–∞–µ—Ç–µ —Ç–∞–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ?',
      '–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–µ–º–Ω–æ–≥–æ –∑–∞–º–µ–¥–ª–∏—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è?',
      '–ö –∫–æ–º—É –≤—ã –æ–±—ã—á–Ω–æ –æ–±—Ä–∞—â–∞–µ—Ç–µ—Å—å –∑–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π?'
    ],
    lowMood: [
      '–ë—ã–≤–∞—é—Ç –ª–∏ –¥–Ω–∏, –∫–æ–≥–¥–∞ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ —Å–µ–±—è —á—É—Ç—å –ª—É—á—à–µ, –∏–ª–∏ —Ç—è–∂–µ–ª–æ —É–∂–µ –¥–∞–≤–Ω–æ?',
      '–ß—Ç–æ –æ–±—ã—á–Ω–æ —Ö–æ—Ç—å –Ω–µ–º–Ω–æ–≥–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–ª–∏ –¥–∞—ë—Ç –æ–±–ª–µ–≥—á–µ–Ω–∏–µ?',
      '–í—ã —Å–µ–π—á–∞—Å –±–æ–ª—å—à–µ –≥—Ä—É—Å—Ç–∏—Ç–µ, —Ç—Ä–µ–≤–æ–∂–∏—Ç–µ—Å—å –∏–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –æ–ø—É—Å—Ç–æ—à—ë–Ω–Ω–æ—Å—Ç—å?'
    ]
  };

  function getGuidingQuestionsForStep(factor, mood) {
    var list = (MENTAL_GUIDING_QUESTIONS[factor] || []).slice();
    list = list.concat(MENTAL_GUIDING_QUESTIONS.general || []);
    if (mood === 1 || mood === 2) list = list.concat(MENTAL_GUIDING_QUESTIONS.lowMood || []);
    var shuffled = list.slice().sort(function() { return Math.random() - 0.5; });
    return shuffled.slice(0, 4);
  }

  const MENTAL_GUIDING_REPLIES = [
    '–ü–ª–æ—Ö–æ / —Ç—Ä—É–¥–Ω–æ',
    '–ü–æ-—Ä–∞–∑–Ω–æ–º—É',
    '–ù–æ—Ä–º–∞–ª—å–Ω–æ',
    '–ù–µ–¥–∞–≤–Ω–æ',
    '–î–∞–≤–Ω–æ',
    '–ù–µ —Ö–æ—á—É –æ—Ç–≤–µ—á–∞—Ç—å'
  ];

  const MENTAL_FACTORS = [
    { id: 'stress', label: '–°—Ç—Ä–µ—Å—Å –∏ –Ω–∞–≥—Ä—É–∑–∫–∞' },
    { id: 'sleep', label: '–°–æ–Ω –∏ —É—Å—Ç–∞–ª–æ—Å—Ç—å' },
    { id: 'work', label: '–†–∞–±–æ—Ç–∞ –∏ –¥–µ–¥–ª–∞–π–Ω—ã' },
    { id: 'awareness', label: '–•–æ—á—É –±–æ–ª—å—à–µ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏' },
    { id: 'other', label: '–î—Ä—É–≥–æ–µ' }
  ];

  // –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∫–≤–µ—Å—Ç—ã: –Ω–∞–∑–≤–∞–Ω–∏–µ + –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è (—Ä–∞–Ω–¥–æ–º –Ω–∞ –¥–µ–Ω—å). category used for default attributes (AriseHabit).
  const DEFAULT_HABITS = [
    { id: 'default-sleep', name: '–°–æ–Ω 7‚Äì8 —á–∞—Å–æ–≤', target: 1, reminders: ['22:30'], variations: ['–õ–µ—á—å –¥–æ 23:00', '–°–æ–Ω 7+ —á–∞—Å–æ–≤', '–ë–µ–∑ —ç–∫—Ä–∞–Ω–æ–≤ –∑–∞ —á–∞—Å –¥–æ —Å–Ω–∞'], category: 'sleep' },
    { id: 'default-water-morning', name: '–í–æ–¥–∞ —É—Ç—Ä–æ–º', target: 1, reminders: ['07:30'], variations: ['–°—Ç–∞–∫–∞–Ω –≤–æ–¥—ã –ø–æ—Å–ª–µ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è', '–¢—ë–ø–ª–∞—è –≤–æ–¥–∞ —Å –ª–∏–º–æ–Ω–æ–º', '–î–≤–∞ —Å—Ç–∞–∫–∞–Ω–∞ –≤–æ–¥—ã –¥–æ –∑–∞–≤—Ç—Ä–∞–∫–∞'], category: 'water' },
    { id: 'default-warmup', name: '–ó–∞—Ä—è–¥–∫–∞ —É—Ç—Ä–æ–º', target: 1, reminders: ['08:00'], variations: ['10 –º–∏–Ω –ª—ë–≥–∫–æ–π —Ä–∞–∑–º–∏–Ω–∫–∏', '–°—É—Å—Ç–∞–≤–Ω–∞—è –≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞ 5 –º–∏–Ω', '5 –º–∏–Ω –ø–æ—Ç—è–≥–∏–≤–∞–Ω–∏–π + 5 –º–∏–Ω —Ö–æ–¥—å–±—ã'], category: 'exercise' },
    { id: 'default-calisthenics', name: '–°–∏–ª–æ–≤–∞—è/–∫–∞–ª–∏—Å—Ç–µ–Ω–∏–∫–∞', target: 1, reminders: ['08:30'], variations: ['10 –ø—Ä–∏—Å–µ–¥–∞–Ω–∏–π + 10 –æ—Ç–∂–∏–º–∞–Ω–∏–π', '–ü–ª–∞–Ω–∫–∞ 1 –º–∏–Ω + –≤—ã–ø–∞–¥—ã', '–ë—É—Ä–ø–∏ 5 —Ä–∞–∑ –∏–ª–∏ –æ—Ç–∂–∏–º–∞–Ω–∏—è 15'], category: 'exercise' },
    { id: 'default-breakfast', name: '–ó–∞–≤—Ç—Ä–∞–∫', target: 1, reminders: ['09:00'], variations: ['–ó–∞–≤—Ç—Ä–∞–∫ –≤ —Ç–µ—á–µ–Ω–∏–µ —á–∞—Å–∞ –ø–æ—Å–ª–µ –ø–æ–¥—ä—ë–º–∞', '–ó–∞–≤—Ç—Ä–∞–∫ —Å –±–µ–ª–∫–æ–º', '–û—Å–æ–∑–Ω–∞–Ω–Ω—ã–π –∑–∞–≤—Ç—Ä–∞–∫ –±–µ–∑ —Ç–µ–ª–µ—Ñ–æ–Ω–∞'], category: 'exercise' },
    { id: 'default-water-day', name: '–í–æ–¥–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è', target: 1, reminders: ['12:00', '15:00'], variations: ['–ù–æ—Ä–º–∞ –≤–æ–¥—ã –∑–∞ –¥–µ–Ω—å', '–°—Ç–∞–∫–∞–Ω –∫–∞–∂–¥—ã–π —á–∞—Å —Ä–∞–±–æ—Ç—ã', '6‚Äì8 —Å—Ç–∞–∫–∞–Ω–æ–≤ –∑–∞ –¥–µ–Ω—å'], category: 'water' },
    { id: 'default-walk-day', name: '–°–≤–µ–∂–∏–π –≤–æ–∑–¥—É—Ö', target: 1, reminders: ['12:30'], variations: ['–ü—Ä–æ–≥—É–ª–∫–∞ 15+ –º–∏–Ω', '–í—ã–π—Ç–∏ –Ω–∞ –±–∞–ª–∫–æ–Ω/—É–ª–∏—Ü—É 10 –º–∏–Ω', '–ü—Ä–æ–≥—É–ª–∫–∞ –≤ –æ–±–µ–¥–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤'], category: 'exercise' },
    { id: 'default-stretch-day', name: '–†–∞—Å—Ç—è–∂–∫–∞/–º–æ–±–∏–ª—å–Ω–æ—Å—Ç—å', target: 1, reminders: ['13:00', '15:30'], variations: ['–†–∞—Å—Ç—è–∂–∫–∞ 5‚Äì10 –º–∏–Ω', '–ô–æ–≥–∞-–ø–∞—É–∑–∞ 5 –º–∏–Ω', '–ü–æ—Ç—è–Ω—É—Ç—å—Å—è + –Ω–∞–∫–ª–æ–Ω—ã 3 –º–∏–Ω'], category: 'exercise' },
    { id: 'default-reading', name: '–ß—Ç–µ–Ω–∏–µ (–º–æ–∑–≥)', target: 1, reminders: ['19:00'], variations: ['–ß—Ç–µ–Ω–∏–µ 15‚Äì20 –º–∏–Ω', '10 —Å—Ç—Ä–∞–Ω–∏—Ü –∫–Ω–∏–≥–∏', '–°—Ç–∞—Ç—å—è –∏–ª–∏ –≥–ª–∞–≤–∞ –±–µ–∑ —Å–æ—Ü—Å–µ—Ç–µ–π'], category: 'reading' },
    { id: 'default-breath', name: '–î—ã—Ö–∞—Ç–µ–ª—å–Ω–∞—è –ø–∞—É–∑–∞', target: 1, reminders: ['11:00', '15:00'], variations: ['3 –º–∏–Ω –≥–ª—É–±–æ–∫–æ–≥–æ –¥—ã—Ö–∞–Ω–∏—è', '4-4-6: –≤–¥–æ—Ö 4, –∑–∞–¥–µ—Ä–∂–∫–∞ 4, –≤—ã–¥–æ—Ö 6', '5 –≤–¥–æ—Ö–æ–≤ –∂–∏–≤–æ—Ç–æ–º'], category: 'breath' },
    { id: 'default-posture', name: '–†–∞–∑–º–∏–Ω–∫–∞/—Å–º–µ–Ω–∞ –ø–æ–∑—ã', target: 1, reminders: ['11:30', '14:30', '17:00'], variations: ['–í—Å—Ç–∞—Ç—å, –ø–æ—Ç—è–Ω—É—Ç—å—Å—è, –ø—Ä–æ–π—Ç–∏—Å—å', '3 –º–∏–Ω —Ö–æ–¥—å–±—ã + –∫—Ä—É–≥–æ–≤—ã–µ –ø–ª–µ—á–∏', '–í—Å—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π —á–∞—Å –Ω–∞ 2 –º–∏–Ω'], category: 'exercise' },
    { id: 'default-walk-evening', name: '–í–µ—á–µ—Ä–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å', target: 1, reminders: ['18:00'], variations: ['–í–µ—á–µ—Ä–Ω—è—è –ø—Ä–æ–≥—É–ª–∫–∞ 15 –º–∏–Ω', '–õ—ë–≥–∫–∞—è –∑–∞—Ä—è–¥–∫–∞ –∏–ª–∏ —Ä–∞—Å—Ç—è–∂–∫–∞', '–ü—Ä–æ–≥—É–ª–∫–∞ –ø–æ—Å–ª–µ —É–∂–∏–Ω–∞'], category: 'exercise' },
    { id: 'default-screens-off', name: '–≠–∫—Ä–∞–Ω—ã –ø–µ—Ä–µ–¥ —Å–Ω–æ–º', target: 1, reminders: ['21:00'], variations: ['–≠–∫—Ä–∞–Ω—ã –≤—ã–∫–ª—é—á–∏—Ç—å –∑–∞ —á–∞—Å –¥–æ —Å–Ω–∞', '–†–µ–∂–∏–º ¬´–ù–µ –±–µ—Å–ø–æ–∫–æ–∏—Ç—å¬ª –∑–∞ 1 —á', '–¢–µ–ª–µ—Ñ–æ–Ω –≤–Ω–µ —Å–ø–∞–ª—å–Ω–∏'], category: 'screens_off' },
    { id: 'default-stretch-evening', name: '–†–∞—Å—Ç—è–∂–∫–∞ –≤–µ—á–µ—Ä–æ–º', target: 1, reminders: ['20:30'], variations: ['–†–∞—Å—Ç—è–∂–∫–∞ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º 5 –º–∏–Ω', '–†–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ —à–µ–∏ –∏ –ø–ª–µ—á', '–ô–æ–≥–∞ –Ω–∞ –∫—Ä–æ–≤–∞—Ç–∏ 5 –º–∏–Ω'], category: 'exercise' },
    { id: 'default-ritual', name: '–†–∏—Ç—É–∞–ª –ø–µ—Ä–µ–¥ —Å–Ω–æ–º', target: 1, reminders: ['21:30'], variations: ['–ß—Ç–µ–Ω–∏–µ –∏–ª–∏ –¥–Ω–µ–≤–Ω–∏–∫ 10 –º–∏–Ω', '–ß–∞–π –±–µ–∑ –∫–æ—Ñ–µ–∏–Ω–∞ + —Ç–∏—à–∏–Ω–∞', '–ü–ª–∞–Ω –Ω–∞ –∑–∞–≤—Ç—Ä–∞ + 5 –º–∏–Ω —Ç–∏—à–∏–Ω—ã'], category: 'ritual' }
  ];

  // WHY: Ensures every habit has attributes for RPG-style progression (AriseHabit design).
  function normalizeHabit(habit) {
    if (!habit.reminders && habit.reminder) habit.reminders = [habit.reminder];
    if (!habit.reminders) habit.reminders = [];
    if (!habit.variations || !habit.variations.length) habit.variations = [habit.name || '–ö–≤–µ—Å—Ç'];
    if (!habit.attributes && typeof AriseConfig !== 'undefined' && AriseConfig.getHabitAttributes) {
      habit.attributes = AriseConfig.getHabitAttributes(habit);
    }
    if (!habit.streakRule) habit.streakRule = { type: 'daily' };
    return habit;
  }

  function dailySeed(dateKey) {
    return (typeof HabitCore !== 'undefined' && HabitCore.dailySeed) ? HabitCore.dailySeed(dateKey) : (function () { var h = 0; for (var i = 0; i < dateKey.length; i++) h = ((h << 5) - h) + dateKey.charCodeAt(i) | 0; return Math.abs(h); })();
  }

  function getTodaysVariation(habit, dateKey) {
    return (typeof HabitCore !== 'undefined' && HabitCore.getTodaysVariation) ? HabitCore.getTodaysVariation(habit, dateKey) : (habit.variations || [habit.name])[0] || habit.name || '';
  }

  function getDayStats(dateKey) {
    if (!state.habits.length) return { percent: 0, xp: 0 };
    return (typeof HabitCore !== 'undefined' && HabitCore.getDayStats) ? HabitCore.getDayStats(state.habits, state.completions, dateKey, XP_PER_HABIT_FULL) : (function () {
      var totalPct = 0, xp = 0;
      state.habits.forEach(function (h) {
        var c = getCompletions(h.id, dateKey);
        var t = Math.max(1, h.target || 1);
        var pct = Math.min(1, c / t);
        totalPct += pct;
        xp += Math.round(pct * XP_PER_HABIT_FULL);
      });
      return { percent: Math.round((totalPct / state.habits.length) * 100), xp: xp };
    })();
  }

  function loadState() {
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw) {
        const data = JSON.parse(raw);
        state.habits = (data.habits || []).map(normalizeHabit);
        state.completions = data.completions || {};
      }
      if (state.habits.length === 0) {
        state.habits = DEFAULT_HABITS.map(h => ({ ...h }));
      }
      const notif = localStorage.getItem(NOTIFICATION_KEY);
      state.notificationsEnabled = notif === 'true';
    } catch (e) {
      state.habits = [];
      state.completions = {};
      state.habits = DEFAULT_HABITS.map(h => ({ ...h }));
    }
  }

  // WHY: Migration for AriseHabit ‚Äî extend character with attributes/perks without breaking existing saves.
  function loadCharacter() {
    try {
      const raw = localStorage.getItem(CHARACTER_KEY);
      state.character = raw ? JSON.parse(raw) : null;
      if (state.character && !state.character.achievements) state.character.achievements = [];
      if (state.character && state.character.lastActivityDate === undefined) state.character.lastActivityDate = null;
      if (state.character && state.character.xpAddedToday === undefined) state.character.xpAddedToday = 0;
      if (state.character && state.character.xpAddedTodayDate === undefined) state.character.xpAddedTodayDate = null;
      if (state.character && !state.character.attributes) {
        state.character.attributes = {};
        if (typeof AriseConfig !== 'undefined' && AriseConfig.GAME_CONFIG && AriseConfig.GAME_CONFIG.attributes) {
          AriseConfig.GAME_CONFIG.attributes.forEach(function (a) {
            state.character.attributes[a.id] = 50;
          });
        }
      }
      if (state.character && !state.character.unlockedPerks) state.character.unlockedPerks = [];
      if (state.character && !state.character.equippedPerks) state.character.equippedPerks = [];
    } catch (e) {
      state.character = null;
    }
  }

  function saveCharacter() {
    if (state.character) localStorage.setItem(CHARACTER_KEY, JSON.stringify(state.character));
  }

  function getLevelFromXp(totalXp) {
    return (typeof HabitCore !== 'undefined' && HabitCore.getLevelFromXp) ? HabitCore.getLevelFromXp(totalXp, XP_LEVELS) : (function () { var level = 1; for (var i = 1; i < XP_LEVELS.length; i++) { if (totalXp >= XP_LEVELS[i]) level = i + 1; else break; } return level; })();
  }

  function xpForNextLevel(level) {
    return (typeof HabitCore !== 'undefined' && HabitCore.xpForNextLevel) ? HabitCore.xpForNextLevel(level, XP_LEVELS) : (XP_LEVELS[level] !== undefined ? XP_LEVELS[level] - XP_LEVELS[level - 1] : 500);
  }

  function xpAtLevelStart(level) {
    return (typeof HabitCore !== 'undefined' && HabitCore.xpAtLevelStart) ? HabitCore.xpAtLevelStart(level, XP_LEVELS) : (XP_LEVELS[level - 1] || 0);
  }

  // WHY: Streak multiplier rewards consistency (engagement); applied once to daily total (config: game-config.js).
  function computeTodayXp() {
    const today = todayKey();
    var rawXp = 0;
    state.habits.forEach(function (h) {
      const current = getCompletions(h.id, today);
      const target = Math.max(1, h.target || 1);
      const pct = Math.min(1, current / target);
      rawXp += pct * XP_PER_HABIT_FULL;
    });
    var streakMult = 1;
    if (typeof AriseConfig !== 'undefined' && AriseConfig.getStreakMultiplier && state.character && state.character.streak) {
      streakMult = AriseConfig.getStreakMultiplier(state.character.streak);
    }
    return Math.round(rawXp * streakMult);
  }

  function updateCharacterXp() {
    if (!state.character) return;
    const today = todayKey();
    if (state.character.xpAddedTodayDate !== today) {
      state.character.xpAddedToday = 0;
      state.character.xpAddedTodayDate = today;
    }
    const currentTodayXp = computeTodayXp();
    const delta = Math.max(0, currentTodayXp - state.character.xpAddedToday);
    state.character.xpAddedToday = currentTodayXp;
    state.character.totalXp = (state.character.totalXp || 0) + delta;
    if (delta > 0) updateStreak();
    checkAchievements();
    saveCharacter();
  }

  function updateStreak() {
    if (!state.character) return;
    const today = todayKey();
    const last = state.character.lastActivityDate;
    const yesterday = (() => { const d = new Date(); d.setDate(d.getDate() - 1); return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'); })();
    if (last === yesterday) {
      state.character.streak = (state.character.streak || 0) + 1;
    } else if (last !== today) {
      state.character.streak = 1;
    }
    state.character.lastActivityDate = today;
  }

  function daysWithActivity() {
    const keys = Object.keys(state.completions);
    const dates = new Set();
    keys.forEach(habitId => {
      Object.keys(state.completions[habitId] || {}).forEach(dateKey => {
        const c = state.completions[habitId][dateKey];
        if (c > 0) dates.add(dateKey);
      });
    });
    return dates.size;
  }

  function totalCompletionsToday() {
    const today = todayKey();
    let sum = 0;
    state.habits.forEach(h => {
      sum += getCompletions(h.id, today);
    });
    return sum;
  }

  function checkAchievements() {
    if (!state.character) return;
    const ach = state.character.achievements || [];
    const level = getLevelFromXp(state.character.totalXp || 0);
    const today = todayKey();
    const todayPct = state.habits.length ? (state.habits.reduce((s, h) => {
      const c = getCompletions(h.id, today);
      const t = Math.max(1, h.target || 1);
      return s + Math.min(1, c / t);
    }, 0) / state.habits.length) * 100 : 0;

    if (!ach.includes('first_steps') && totalCompletionsToday() > 0) ach.push('first_steps');
    if (!ach.includes('streak_3') && (state.character.streak || 0) >= 3) ach.push('streak_3');
    if (!ach.includes('streak_7') && (state.character.streak || 0) >= 7) ach.push('streak_7');
    if (!ach.includes('full_day') && state.habits.length > 0 && todayPct >= 100) ach.push('full_day');
    if (!ach.includes('level_5') && level >= 5) ach.push('level_5');
    if (!ach.includes('week_one') && daysWithActivity() >= 7) ach.push('week_one');
    if (!ach.includes('ten_quests') && totalCompletionsToday() >= 10) ach.push('ten_quests');
    const now = new Date();
    if (!ach.includes('early_bird') && totalCompletionsToday() > 0 && now.getHours() < 10) ach.push('early_bird');
    state.character.achievements = ach;
  }

  function unlockAchievement(id) {
    if (!state.character) return;
    const ach = state.character.achievements || [];
    if (!ach.includes(id)) {
      state.character.achievements = [...ach, id];
      saveCharacter();
    }
  }

  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify({
      habits: state.habits,
      completions: state.completions
    }));
    updateCharacterXp();
    renderHabits();
    renderDayResults();
    renderCalendar();
    updateChart();
    if (state.character) {
      renderCharacterHeader();
      renderAchievements();
    }
  }

  function getCalendarDays(count) {
    var days = [];
    for (var i = count - 1; i >= 0; i--) {
      var d = new Date();
      d.setDate(d.getDate() - i);
      days.push(d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'));
    }
    return days;
  }

  function renderCalendar() {
    var grid = document.getElementById('calendarGrid');
    if (!grid) return;
    var today = todayKey();
    var days = getCalendarDays(28);
    var weekDays = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
    var firstDow = (new Date(days[0].replace(/-/g, '/'))).getDay();
    var html = '<div class="calendar-weekdays">' + weekDays.map(function(w) { return '<span class="calendar-wd">' + w + '</span>'; }).join('') + '</div><div class="calendar-days">';
    for (var i = 0; i < firstDow; i++) html += '<div class="calendar-cell calendar-cell--empty"></div>';
    days.forEach(function(dateKey) {
      var stats = getDayStats(dateKey);
      var parts = dateKey.split('-');
      var dayNum = parseInt(parts[2], 10);
      var isToday = dateKey === today;
      var label = isToday ? '–°–µ–≥–æ–¥–Ω—è' : dayNum;
      html += '<div class="calendar-cell' + (isToday ? ' calendar-cell--today' : '') + '" title="' + dateKey + ' ‚Äî ' + stats.percent + '%, +' + stats.xp + ' XP">' +
        '<span class="calendar-day-num">' + label + '</span>' +
        '<span class="calendar-pct">' + stats.percent + '%</span>' +
        '<span class="calendar-xp">+' + stats.xp + '</span>' +
        '</div>';
    });
    var totalCells = firstDow + days.length;
    var trailingEmpty = (7 - totalCells % 7) % 7;
    for (var j = 0; j < trailingEmpty; j++) html += '<div class="calendar-cell calendar-cell--empty"></div>';
    html += '</div>';
    grid.innerHTML = html;
  }

  function formatDateLong(dateKey) {
    const [y, m, d] = dateKey.split('-').map(Number);
    const date = new Date(y, m - 1, d);
    const months = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è', '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
    return `${d} ${months[date.getMonth()]} ${y}`;
  }

  function renderDayResults() {
    const dateEl = document.getElementById('dayResultsDate');
    const listEl = document.getElementById('dayResultsList');
    const avgEl = document.getElementById('dayResultsAverage');
    const section = document.getElementById('statsPanel');
    if (!section || !listEl) return;

    const today = todayKey();
    if (state.habits.length === 0) {
      if (dateEl) dateEl.textContent = '';
      listEl.innerHTML = '<p class="day-results-none">–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–≤–µ—Å—Ç—ã ‚Äî –∑–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞.</p>';
      if (avgEl) avgEl.textContent = '';
      return;
    }
    if (dateEl) dateEl.textContent = formatDateLong(today);

    let sumPercent = 0;
    const items = state.habits.map(h => {
      const current = getCompletions(h.id, today);
      const target = Math.max(1, h.target || 1);
      const percent = Math.round((current / target) * 100);
      sumPercent += percent;
      return `<div class="day-result-row"><span class="day-result-name">${escapeHtml(h.name)}</span><span class="day-result-pct">${percent}%</span></div>`;
    }).join('');
    listEl.innerHTML = items;
    const avg = Math.round(sumPercent / state.habits.length);
    const xpToday = computeTodayXp();
    if (avgEl) avgEl.innerHTML = `<strong>–ü—Ä–æ–≥—Ä–µ—Å—Å –¥–Ω—è:</strong> ${avg}% ¬∑ <strong>+${xpToday} XP</strong>`;
  }

  function todayKey() {
    return (typeof HabitCore !== 'undefined' && HabitCore.todayKey) ? HabitCore.todayKey() : (function () { var d = new Date(); return d.getFullYear() + '-' + String(d.getMonth() + 1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0'); })();
  }

  function getCompletions(habitId, dateKey) {
    if (!state.completions[habitId]) return 0;
    return state.completions[habitId][dateKey] || 0;
  }

  function setCompletions(habitId, dateKey, count) {
    if (!state.completions[habitId]) state.completions[habitId] = {};
    state.completions[habitId][dateKey] = Math.max(0, count);
  }

  function last7Days() {
    const keys = [];
    for (let i = 6; i >= 0; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      keys.push(
        d.getFullYear() + '-' +
        String(d.getMonth() + 1).padStart(2, '0') + '-' +
        String(d.getDate()).padStart(2, '0')
      );
    }
    return keys;
  }

  function dayLabel(dateKey) {
    const [y, m, d] = dateKey.split('-').map(Number);
    const date = new Date(y, m - 1, d);
    const days = ['–í—Å', '–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±'];
    return days[date.getDay()] + ' ' + d;
  }

  function updateChart() {
    const canvas = document.getElementById('habitChart');
    const legendEl = document.getElementById('chartLegend');
    if (!canvas || state.habits.length === 0) {
      if (chart) {
        chart.destroy();
        chart = null;
      }
      if (legendEl) legendEl.innerHTML = '';
      return;
    }

    const days = last7Days();
    const colors = [
      'rgb(0, 212, 255)',
      'rgb(255, 193, 7)',
      'rgb(0, 230, 118)',
      'rgb(124, 77, 255)',
      'rgb(255, 138, 128)'
    ];

    const datasets = state.habits.slice(0, 8).map((h, i) => {
      const values = days.map(dateKey => {
        const count = getCompletions(h.id, dateKey);
        const target = h.target || 1;
        return target > 0 ? Math.min(1, count / target) * 100 : 0;
      });
      return {
        label: h.name,
        data: values,
        borderColor: colors[i % colors.length],
        backgroundColor: colors[i % colors.length].replace('rgb', 'rgba').replace(')', ', 0.15)'),
        borderWidth: 2,
        fill: true,
        tension: 0.3
      };
    });

    if (chart) chart.destroy();

    chart = new Chart(canvas, {
      type: 'line',
      data: {
        labels: days.map(dayLabel),
        datasets
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        color: '#8b8b9a',
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(20, 20, 31, 0.95)',
            titleColor: '#00d4ff',
            bodyColor: '#e8e8ed',
            borderColor: '#2a2a3a',
            borderWidth: 1,
            callbacks: {
              title: function(tooltipItems) {
                const idx = tooltipItems[0]?.dataIndex;
                if (idx == null) return [];
                return [dayLabel(days[idx]) + ', ' + formatDateLong(days[idx])];
              },
              label: function() { return null; },
              afterBody: function(tooltipItems) {
                const idx = tooltipItems[0]?.dataIndex;
                if (idx == null) return '';
                const dateKey = days[idx];
                let sum = 0;
                const lines = state.habits.slice(0, 8).map(h => {
                  const count = getCompletions(h.id, dateKey);
                  const target = Math.max(1, h.target || 1);
                  const pct = Math.round((count / target) * 100);
                  sum += pct;
                  return h.name + ': ' + pct + '%';
                });
                const avg = state.habits.length ? Math.round(sum / Math.min(state.habits.length, 8)) : 0;
                lines.push('‚Äî‚Äî');
                lines.push('–°—Ä–µ–¥–Ω–µ–µ: ' + avg + '%');
                return lines;
              }
            }
          }
        },
        scales: {
          y: {
            min: 0,
            max: 100,
            ticks: {
              color: '#8b8b9a',
              callback: v => v + '%'
            },
            grid: { color: 'rgba(255,255,255,0.06)' }
          },
          x: {
            ticks: { color: '#8b8b9a' },
            grid: { display: false }
          }
        },
        interaction: {
          intersect: false,
          mode: 'index'
        }
      }
    });

    legendEl.innerHTML = state.habits.slice(0, 8).map((h, i) =>
      `<span><span class="dot" style="background:${colors[i % colors.length]}"></span> ${escapeHtml(h.name)}</span>`
    ).join('');
  }

  function escapeHtml(s) {
    const div = document.createElement('div');
    div.textContent = s;
    return div.innerHTML;
  }

  function renderCharacterHeader() {
    if (!state.character) return;
    const nameEl = document.getElementById('headerCharacterName');
    const levelEl = document.getElementById('characterLevel');
    const barFill = document.getElementById('levelBarFill');
    const xpText = document.getElementById('levelXpText');
    const streakEl = document.getElementById('streakCount');
    const avatar = document.getElementById('characterAvatar');
    if (nameEl) nameEl.textContent = state.character.name || '–ü–µ—Ä—Å–æ–Ω–∞–∂';
    const totalXp = state.character.totalXp || 0;
    const level = getLevelFromXp(totalXp);
    const xpStart = xpAtLevelStart(level);
    const xpNext = xpForNextLevel(level);
    const xpInLevel = totalXp - xpStart;
    const pct = Math.min(100, (xpInLevel / xpNext) * 100);
    if (levelEl) levelEl.textContent = level;
    if (barFill) barFill.style.width = pct + '%';
    if (xpText) xpText.textContent = xpInLevel + ' / ' + xpNext + ' XP';
    if (streakEl) streakEl.textContent = state.character.streak || 0;
    if (avatar) {
      avatar.innerHTML = getPixelAvatarSvg(level);
      avatar.classList.add('character-avatar-pixel');
      avatar.setAttribute('data-level', level);
    }
  }

  function getPixelAvatarSvg(level) {
    var tier = level <= 2 ? 1 : level <= 4 ? 2 : level <= 6 ? 3 : level <= 8 ? 4 : 5;
    return getPixelAvatarTier(tier);
  }

  function getPixelAvatarTier(tier) {
    var bg = '#1a1a2e';
    var dark = '#0f3460';
    var mid = '#16213e';
    var accent = '#e94560';
    var glow = '#ff6b6b';
    var gold = '#e8c547';
    var light = '#4a69bd';
    var svg = '<svg class="pixel-avatar-svg avatar-tier-' + tier + '" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">';
    if (tier === 1) {
      svg += '<rect width="64" height="64" fill="' + bg + '"/>' +
        '<rect x="16" y="8" width="32" height="8" fill="' + mid + '"/>' +
        '<rect x="12" y="16" width="40" height="28" fill="' + mid + '"/>' +
        '<rect x="8" y="20" width="8" height="20" fill="' + dark + '"/>' +
        '<rect x="48" y="20" width="8" height="20" fill="' + dark + '"/>' +
        '<rect x="24" y="44" width="16" height="16" fill="' + mid + '"/>' +
        '<rect x="26" y="24" width="4" height="4" fill="' + accent + '"/>' +
        '<rect x="34" y="24" width="4" height="4" fill="' + accent + '"/>' +
        '<rect x="28" y="32" width="8" height="2" fill="' + accent + '"/>' +
        '<rect x="20" y="14" width="24" height="4" fill="' + dark + '"/>' +
        '<rect x="18" y="12" width="4" height="6" fill="' + bg + '"/>' +
        '<rect x="42" y="12" width="4" height="6" fill="' + bg + '"/>';
    } else if (tier === 2) {
      svg += '<rect width="64" height="64" fill="' + bg + '"/>' +
        '<rect x="14" y="6" width="36" height="10" fill="' + mid + '"/>' +
        '<rect x="10" y="14" width="44" height="30" fill="' + mid + '"/>' +
        '<rect x="6" y="20" width="10" height="22" fill="' + dark + '"/>' +
        '<rect x="48" y="20" width="10" height="22" fill="' + dark + '"/>' +
        '<rect x="22" y="44" width="20" height="16" fill="' + mid + '"/>' +
        '<rect x="24" y="22" width="6" height="6" fill="' + accent + '"/>' +
        '<rect x="34" y="22" width="6" height="6" fill="' + accent + '"/>' +
        '<rect x="26" y="32" width="12" height="3" fill="' + accent + '"/>' +
        '<rect x="18" y="12" width="28" height="5" fill="' + dark + '"/>' +
        '<rect x="16" y="10" width="5" height="7" fill="' + bg + '"/>' +
        '<rect x="43" y="10" width="5" height="7" fill="' + bg + '"/>' +
        '<rect x="20" y="18" width="6" height="4" fill="' + light + '"/>' +
        '<rect x="38" y="18" width="6" height="4" fill="' + light + '"/>';
    } else if (tier === 3) {
      svg += '<rect width="64" height="64" fill="' + bg + '"/>' +
        '<rect x="12" y="4" width="40" height="12" fill="' + mid + '"/>' +
        '<rect x="8" y="14" width="48" height="32" fill="' + mid + '"/>' +
        '<rect x="4" y="20" width="12" height="24" fill="' + dark + '"/>' +
        '<rect x="48" y="20" width="12" height="24" fill="' + dark + '"/>' +
        '<rect x="20" y="46" width="24" height="14" fill="' + mid + '"/>' +
        '<rect x="22" y="20" width="8" height="8" fill="' + glow + '"/>' +
        '<rect x="34" y="20" width="8" height="8" fill="' + glow + '"/>' +
        '<rect x="24" y="32" width="16" height="4" fill="' + glow + '"/>' +
        '<rect x="16" y="10" width="32" height="6" fill="' + dark + '"/>' +
        '<rect x="14" y="8" width="6" height="8" fill="' + bg + '"/>' +
        '<rect x="44" y="8" width="6" height="8" fill="' + bg + '"/>' +
        '<rect x="18" y="16" width="8" height="5" fill="' + light + '"/>' +
        '<rect x="38" y="16" width="8" height="5" fill="' + light + '"/>' +
        '<rect x="26" y="6" width="12" height="3" fill="' + accent + '"/>' +
        '<rect x="10" y="42" width="8" height="6" fill="' + dark + '"/>' +
        '<rect x="46" y="42" width="8" height="6" fill="' + dark + '"/>';
    } else if (tier === 4) {
      svg += '<rect width="64" height="64" fill="' + bg + '"/>' +
        '<rect x="10" y="2" width="44" height="14" fill="' + mid + '"/>' +
        '<rect x="6" y="14" width="52" height="34" fill="' + mid + '"/>' +
        '<rect x="2" y="20" width="14" height="26" fill="' + dark + '"/>' +
        '<rect x="48" y="20" width="14" height="26" fill="' + dark + '"/>' +
        '<rect x="18" y="48" width="28" height="12" fill="' + mid + '"/>' +
        '<rect x="20" y="18" width="10" height="10" fill="' + glow + '"/>' +
        '<rect x="34" y="18" width="10" height="10" fill="' + glow + '"/>' +
        '<rect x="22" y="32" width="20" height="5" fill="' + glow + '"/>' +
        '<rect x="14" y="8" width="36" height="7" fill="' + dark + '"/>' +
        '<rect x="12" y="6" width="7" height="9" fill="' + bg + '"/>' +
        '<rect x="45" y="6" width="7" height="9" fill="' + bg + '"/>' +
        '<rect x="16" y="14" width="10" height="6" fill="' + light + '"/>' +
        '<rect x="38" y="14" width="10" height="6" fill="' + light + '"/>' +
        '<rect x="24" y="4" width="16" height="4" fill="' + accent + '"/>' +
        '<rect x="8" y="40" width="10" height="8" fill="' + dark + '"/>' +
        '<rect x="46" y="40" width="10" height="8" fill="' + dark + '"/>' +
        '<rect x="28" y="0" width="8" height="4" fill="' + gold + '"/>' +
        '<rect x="26" y="48" width="4" height="6" fill="' + gold + '"/>' +
        '<rect x="34" y="48" width="4" height="6" fill="' + gold + '"/>';
    } else {
      svg += '<rect width="64" height="64" fill="' + bg + '"/>' +
        '<rect x="8" y="0" width="48" height="16" fill="' + mid + '"/>' +
        '<rect x="4" y="14" width="56" height="36" fill="' + mid + '"/>' +
        '<rect x="0" y="22" width="16" height="28" fill="' + dark + '"/>' +
        '<rect x="48" y="22" width="16" height="28" fill="' + dark + '"/>' +
        '<rect x="16" y="50" width="32" height="10" fill="' + mid + '"/>' +
        '<rect x="18" y="16" width="12" height="12" fill="' + glow + '"/>' +
        '<rect x="34" y="16" width="12" height="12" fill="' + glow + '"/>' +
        '<rect x="20" y="32" width="24" height="6" fill="' + glow + '"/>' +
        '<rect x="12" y="6" width="40" height="8" fill="' + dark + '"/>' +
        '<rect x="10" y="4" width="8" height="10" fill="' + bg + '"/>' +
        '<rect x="46" y="4" width="8" height="10" fill="' + bg + '"/>' +
        '<rect x="14" y="12" width="12" height="7" fill="' + light + '"/>' +
        '<rect x="38" y="12" width="12" height="7" fill="' + light + '"/>' +
        '<rect x="22" y="2" width="20" height="5" fill="' + accent + '"/>' +
        '<rect x="6" y="38" width="12" height="10" fill="' + dark + '"/>' +
        '<rect x="46" y="38" width="12" height="10" fill="' + dark + '"/>' +
        '<rect x="26" y="0" width="12" height="3" fill="' + gold + '"/>' +
        '<rect x="24" y="50" width="6" height="6" fill="' + gold + '"/>' +
        '<rect x="34" y="50" width="6" height="6" fill="' + gold + '"/>' +
        '<rect x="28" y="18" width="2" height="2" fill="' + gold + '"/>' +
        '<rect x="34" y="18" width="2" height="2" fill="' + gold + '"/>' +
        '<rect x="30" y="2" width="4" height="6" fill="' + gold + '"/>';
    }
    svg += '</svg>';
    return svg;
  }

  function renderAchievements() {
    const grid = document.getElementById('achievementsGrid');
    if (!grid) return;
    const unlocked = (state.character && state.character.achievements) ? state.character.achievements : [];
    grid.innerHTML = ACHIEVEMENTS_LIST.map(function(a) {
      var done = unlocked.includes(a.id);
      var tier = a.tier || 'bronze';
      return '<div class="achievement-item achievement-tier-' + tier + ' ' + (done ? 'unlocked' : 'locked') + '" title="' + escapeHtml(a.desc) + '">' +
        '<span class="achievement-badge">' +
        '<span class="achievement-icon">' + a.icon + '</span>' +
        '</span>' +
        '<span class="achievement-name">' + escapeHtml(a.name) + '</span>' +
        '</div>';
    }).join('');
  }

  function showCreateCharacter() {
    var el = document.getElementById('createCharacterScreen');
    var main = document.getElementById('mainApp');
    if (el) { el.hidden = false; el.style.display = ''; }
    if (main) { main.hidden = true; main.style.display = 'none'; }
  }

  function showMainApp() {
    var el = document.getElementById('createCharacterScreen');
    var main = document.getElementById('mainApp');
    if (el) { el.hidden = true; el.style.display = 'none'; }
    if (main) { main.hidden = false; main.style.display = ''; }
    renderCharacterHeader();
    renderAchievements();
  }

  function createCharacter(e) {
    if (e && e.preventDefault) e.preventDefault();
    var nameInput = document.getElementById('characterName');
    var name = nameInput ? String(nameInput.value || '').trim() : '';
    var goalInput = document.getElementById('characterGoal');
    var goal = goalInput ? String(goalInput.value || '').trim() : '';
    if (!name) {
      if (nameInput) nameInput.focus();
      return;
    }
    state.character = {
      name: name,
      goal: goal || null,
      totalXp: 0,
      streak: 0,
      lastActivityDate: null,
      achievements: [],
      xpAddedToday: 0,
      xpAddedTodayDate: null,
      createdAt: new Date().toISOString()
    };
    saveCharacter();
    showMainApp();
    try {
      renderCharacterHeader();
      renderAchievements();
      renderHabits();
      renderDayResults();
      renderCalendar();
      updateChart();
      updateNotificationUI();
      renderMentalHealth();
    } catch (err) {
      console.error(err);
    }
  }

  function renderHabits() {
    const list = document.getElementById('habitsList');
    if (!list) return;

    if (state.habits.length === 0) {
      list.innerHTML = `
        <li class="empty-state">
          <p>–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–∏–≤—ã—á–µ–∫. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–ü–∏—Ç—å –≤–æ–¥—É¬ª –∏–ª–∏ ¬´10 –º–∏–Ω—É—Ç –∑–∞—Ä—è–¥–∫–∏¬ª.</p>
          <button type="button" class="btn btn-primary" id="btnAddFirst">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</button>
        </li>`;
      list.querySelector('#btnAddFirst')?.addEventListener('click', openAddModal);
      return;
    }

    const today = todayKey();
    list.innerHTML = state.habits.map(h => {
      const current = getCompletions(h.id, today);
      const target = Math.max(1, h.target || 1);
      const isDone = current >= target;
      const reminders = h.reminders && h.reminders.length ? h.reminders : [];
      const remindersText = reminders.length ? ' ¬∑ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è: ' + reminders.join(', ') : '';
      const displayName = getTodaysVariation(h, today);
      const options = Array.from({ length: target + 1 }, (_, i) => `<option value="${i}" ${i === current ? ' selected' : ''}>${i}</option>`).join('');
      const dots = Array.from({ length: target }, (_, i) => {
        const value = i + 1;
        const done = value <= current;
        return `<button type="button" class="habit-progress-dot ${done ? 'done' : ''}" data-value="${value}" aria-label="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ${value} –∏–∑ ${target}">${done ? '‚úì' : ''}</button>`;
      }).join('');
      const percent = target > 0 ? Math.min(100, (current / target) * 100) : 0;
      return `
        <li class="habit-item" data-id="${escapeHtml(h.id)}">
          <div class="habit-count-select-wrap">
            <label class="habit-count-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ</label>
            <select class="habit-count-select" aria-label="–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${escapeHtml(displayName)}">
              ${options}
            </select>
            <span class="habit-count-of">–∏–∑ ${target}</span>
          </div>
          <div class="habit-info">
            <div class="habit-name">${escapeHtml(displayName)}</div>
            <div class="habit-meta">–¶–µ–ª—å: ${target} —Ä–∞–∑ –≤ –¥–µ–Ω—å${remindersText}</div>
            <div class="habit-progress-wrap">
              <div class="habit-progress-dots habit-progress-dots-clickable">${dots}</div>
              <div class="habit-progress-bar-wrap"><div class="habit-progress-bar-fill" style="width:${percent}%"></div></div>
              <span class="habit-progress-text">${current} –∏–∑ ${target} ¬∑ ${Math.round(percent)}%</span>
            </div>
          </div>
          <div class="habit-actions">
            <button type="button" class="btn btn-ghost btn-edit" aria-label="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úé</button>
            <button type="button" class="btn btn-ghost btn-delete" aria-label="–£–¥–∞–ª–∏—Ç—å">√ó</button>
          </div>
        </li>`;
    }).join('');

    list.querySelectorAll('.habit-count-select').forEach(sel => {
      sel.addEventListener('change', () => {
        const item = sel.closest('.habit-item');
        const id = item?.dataset.id;
        const value = parseInt(sel.value, 10);
        setCompletions(id, today, value);
        saveState();
      });
    });

    list.querySelectorAll('.habit-progress-dots-clickable .habit-progress-dot').forEach(btn => {
      btn.addEventListener('click', () => {
        const item = btn.closest('.habit-item');
        const id = item?.dataset.id;
        const value = parseInt(btn.dataset.value, 10);
        setCompletions(id, today, value);
        saveState();
      });
    });

    list.querySelectorAll('.btn-edit').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.closest('.habit-item')?.dataset.id;
        openEditModal(id);
      });
    });

    list.querySelectorAll('.btn-delete').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.closest('.habit-item')?.dataset.id;
        if (id && confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø—Ä–∏–≤—ã—á–∫—É?')) {
          state.habits = state.habits.filter(h => h.id !== id);
          delete state.completions[id];
          saveState();
        }
      });
    });
  }

  function renderRemindersList(times) {
    const list = document.getElementById('remindersList');
    if (!list) return;
    list.innerHTML = (times || []).map((t, i) => `
      <div class="reminder-row" data-index="${i}">
        <input type="time" value="${escapeHtml(t)}" aria-label="–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è ${i + 1}">
        <button type="button" class="btn-remove" aria-label="–£–¥–∞–ª–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ">&times;</button>
      </div>
    `).join('');
    list.querySelectorAll('.reminder-row .btn-remove').forEach(btn => {
      btn.addEventListener('click', () => btn.closest('.reminder-row')?.remove());
    });
  }

  function addReminderRow() {
    const list = document.getElementById('remindersList');
    if (!list) return;
    const row = document.createElement('div');
    row.className = 'reminder-row';
    row.innerHTML = `
      <input type="time" value="12:00" aria-label="–í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è">
      <button type="button" class="btn-remove" aria-label="–£–¥–∞–ª–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ">&times;</button>
    `;
    row.querySelector('.btn-remove').addEventListener('click', () => row.remove());
    list.appendChild(row);
  }

  function getRemindersFromForm() {
    const list = document.getElementById('remindersList');
    if (!list) return [];
    return Array.from(list.querySelectorAll('.reminder-row input'))
      .map(inp => inp.value.trim())
      .filter(Boolean);
  }

  function openAddModal() {
    document.getElementById('modalTitle').textContent = '–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞';
    document.getElementById('habitForm').reset();
    document.getElementById('habitId').value = '';
    document.getElementById('habitTarget').value = '1';
    renderRemindersList([]);
    document.getElementById('modalOverlay').hidden = false;
  }

  function openEditModal(id) {
    const habit = state.habits.find(h => h.id === id);
    if (!habit) return;
    document.getElementById('modalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤—ã—á–∫—É';
    document.getElementById('habitId').value = habit.id;
    document.getElementById('habitName').value = habit.name;
    document.getElementById('habitTarget').value = habit.target || 1;
    renderRemindersList(habit.reminders || []);
    document.getElementById('modalOverlay').hidden = false;
  }

  function closeModal() {
    document.getElementById('modalOverlay').hidden = true;
  }

  function submitHabit(e) {
    e.preventDefault();
    const id = document.getElementById('habitId').value;
    const name = document.getElementById('habitName').value.trim();
    const target = parseInt(document.getElementById('habitTarget').value, 10) || 1;
    const reminders = getRemindersFromForm();

    if (!name) return;

    if (id) {
      const habit = state.habits.find(h => h.id === id);
      if (habit) {
        habit.name = name;
        habit.target = target;
        habit.reminders = reminders;
      }
    } else {
      state.habits.push({
        id: 'h-' + Date.now(),
        name,
        target,
        reminders
      });
    }
    saveState();
    closeModal();
  }

  function requestNotificationPermission() {
    if (!('Notification' in window)) {
      alert('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ.');
      return;
    }
    if (Notification.permission === 'granted') {
      state.notificationsEnabled = true;
      localStorage.setItem(NOTIFICATION_KEY, 'true');
      startNotificationChecks();
      updateNotificationUI();
      return;
    }
    if (Notification.permission !== 'denied') {
      Notification.requestPermission().then(p => {
        state.notificationsEnabled = p === 'granted';
        localStorage.setItem(NOTIFICATION_KEY, state.notificationsEnabled ? 'true' : 'false');
        if (state.notificationsEnabled) startNotificationChecks();
        updateNotificationUI();
      });
    } else {
      alert('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã. –†–∞–∑—Ä–µ—à–∏—Ç–µ –∏—Ö –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Å–∞–π—Ç–∞.');
    }
  }

  function toggleNotifications() {
    if (state.notificationsEnabled) {
      state.notificationsEnabled = false;
      localStorage.setItem(NOTIFICATION_KEY, 'false');
      if (notificationCheckInterval) {
        clearInterval(notificationCheckInterval);
        notificationCheckInterval = null;
      }
    } else {
      requestNotificationPermission();
    }
    updateNotificationUI();
  }

  function updateNotificationUI() {
    const btn = document.getElementById('btnNotifications');
    const badge = document.getElementById('notificationBadge');
    if (!btn || !badge) return;
    badge.textContent = state.notificationsEnabled ? '–í–∫–ª' : '–í—ã–∫–ª';
    btn.classList.toggle('notifications-on', state.notificationsEnabled);
  }

  function getWellnessSentToday() {
    try {
      var raw = localStorage.getItem(WELLNESS_NOTIFY_KEY);
      if (!raw) return {};
      var data = JSON.parse(raw);
      return data || {};
    } catch (e) { return {}; }
  }

  function markWellnessSent(hour) {
    var today = todayKey();
    var data = getWellnessSentToday();
    if (!data[today]) data[today] = [];
    if (data[today].indexOf(hour) === -1) data[today].push(hour);
    try { localStorage.setItem(WELLNESS_NOTIFY_KEY, JSON.stringify(data)); } catch (e) {}
  }

  function wasWellnessSentToday(hour) {
    var data = getWellnessSentToday();
    var today = todayKey();
    return (data[today] || []).indexOf(hour) !== -1;
  }

  function startNotificationChecks() {
    if (notificationCheckInterval) return;
    function check() {
      if (!state.notificationsEnabled || Notification.permission !== 'granted') return;
      const now = new Date();
      const currentMinutes = now.getHours() * 60 + now.getMinutes();
      const today = todayKey();
      const times = (t) => {
        const [hh, mm] = t.split(':').map(Number);
        return (hh || 0) * 60 + (mm || 0);
      };
      state.habits.forEach(h => {
        const reminderList = h.reminders && h.reminders.length ? h.reminders : [];
        reminderList.forEach(reminderTime => {
          const key = h.id + '|' + reminderTime;
          if (notifiedToday[key] === today) return;
          const reminderMinutes = times(reminderTime);
          const diff = Math.abs(currentMinutes - reminderMinutes);
          if (diff <= 1) {
            const done = getCompletions(h.id, today);
            const target = h.target || 1;
            if (done < target) {
              try {
                new Notification('Habit Tracker', {
                  body: `–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ${h.name}. –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è: ${done} –∏–∑ ${target}`,
                  icon: null
                });
                notifiedToday[key] = today;
              } catch (err) {}
              return;
            }
          }
        });
      });
      // –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ç —Å–æ–≤–µ—Ç–Ω–∏–∫–∞ (—É—Ç—Ä–æ, –¥–µ–Ω—å, –≤–µ—á–µ—Ä)
      WELLNESS_CHECK_TIMES.forEach((timeStr, index) => {
        const [hh, mm] = timeStr.split(':').map(Number);
        const slotMinutes = (hh || 0) * 60 + (mm || 0);
        const diff = Math.abs(currentMinutes - slotMinutes);
        if (diff <= 1 && !wasWellnessSentToday(hh)) {
          try {
            const msg = WELLNESS_MESSAGES[index % WELLNESS_MESSAGES.length];
            new Notification('–°–æ–≤–µ—Ç–Ω–∏–∫ ‚Äî –ú–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ', {
              body: msg,
              icon: null
            });
            markWellnessSent(hh);
          } catch (err) {}
        }
      });
    }
    check();
    notificationCheckInterval = setInterval(check, 60000);
  }

  function showReminderNotification(habit) {
    if (!state.notificationsEnabled || Notification.permission !== 'granted') return;
    const today = todayKey();
    const done = getCompletions(habit.id, today);
    const target = habit.target || 1;
    try {
      new Notification('Habit Tracker', {
        body: `–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: ${habit.name}. –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è: ${done}/${target}`,
        icon: null
      });
    } catch (err) {}
  }

  function loadMentalState() {
    try {
      const raw = localStorage.getItem(MENTAL_STORAGE_KEY);
      if (raw) {
        const data = JSON.parse(raw);
        state.mental = { step: data.step || 'welcome', mood: data.mood, factor: data.factor, messages: data.messages || [] };
      }
    } catch (e) {}
  }

  function saveMentalState() {
    localStorage.setItem(MENTAL_STORAGE_KEY, JSON.stringify(state.mental));
  }

  function getMentalAdvice(factor, mood) {
    const key = factor && MENTAL_TIPS[factor] ? factor : 'general';
    let pool = [...(MENTAL_TIPS[key] || []), ...(MENTAL_TIPS.general || [])];
    if (mood === 1 || mood === 2) pool = [...(MENTAL_TIPS.lowMood || []), ...pool];
    const shuffled = pool.slice().sort(function() { return Math.random() - 0.5; });
    return shuffled.slice(0, 3);
  }

  var mentalTypingEl = null;

  function addMentalMessage(role, text) {
    state.mental.messages.push({ role, text, ts: Date.now() });
    if (state.mental.messages.length > 50) state.mental.messages = state.mental.messages.slice(-50);
    saveMentalState();
  }

  function showMentalTyping() {
    var chat = document.getElementById('mentalChat');
    if (!chat || mentalTypingEl) return;
    mentalTypingEl = document.createElement('div');
    mentalTypingEl.className = 'mental-typing';
    mentalTypingEl.setAttribute('aria-live', 'polite');
    mentalTypingEl.innerHTML = '<div class="mental-typing-bubble"><span class="mental-typing-dot"></span><span class="mental-typing-dot"></span><span class="mental-typing-dot"></span></div>';
    chat.appendChild(mentalTypingEl);
    chat.scrollTop = chat.scrollHeight;
  }

  function hideMentalTyping() {
    if (mentalTypingEl && mentalTypingEl.parentNode) mentalTypingEl.parentNode.removeChild(mentalTypingEl);
    mentalTypingEl = null;
  }

  function assistantReplyIntro() {
    var intros = [
      '–í–æ—Ç —á—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å:',
      '–î–µ—Ä–∂–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–¥–µ–π:',
      '–ü–æ–ø—Ä–æ–±—É–π—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä:',
      '–ß–∞—Å—Ç–æ —Å–æ–≤–µ—Ç—É—é—Ç —Ç–∞–∫–æ–µ:',
      '–ú–æ–∂–Ω–æ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ç–∞–∫:',
      '–í–æ—Ç —á—Ç–æ –Ω–µ—Ä–µ–¥–∫–æ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:'
    ];
    return intros[Math.floor(Math.random() * intros.length)];
  }

  function assistantReplyMore() {
    var intros = [
      '–ï—â—ë –∏–¥–µ–∏:',
      '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:',
      '–ï—â—ë –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:',
      '–í–æ—Ç –µ—â—ë:'
    ];
    return intros[Math.floor(Math.random() * intros.length)];
  }

  function showTypingThenReply(replyText, stepValue) {
    showMentalTyping();
    var delay = 1200 + Math.random() * 1100;
    setTimeout(function() {
      hideMentalTyping();
      addMentalMessage('assistant', replyText);
      if (stepValue !== undefined) state.mental.step = stepValue;
      saveMentalState();
      renderMentalHealth();
      var chat = document.getElementById('mentalChat');
      if (chat) chat.scrollTop = chat.scrollHeight;
    }, delay);
  }

  function renderMentalHealth() {
    const chat = document.getElementById('mentalChat');
    const choicesWrap = document.getElementById('mentalChoices');
    const replyWrap = document.getElementById('mentalReply');
    if (!chat) return;
    if (!choicesWrap) return;

    if ((state.mental.step === 'welcome' || state.mental.step === 'ask_mood') && state.mental.messages.length === 0) {
      addMentalMessage('assistant', '–ü—Ä–∏–≤–µ—Ç. –Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –≤–∞—à–µ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç—å. ' + MENTAL_QUESTIONS.mood);
      state.mental.step = 'ask_mood';
      saveMentalState();
    }

    chat.innerHTML = state.mental.messages.map(function(m) {
      var role = m.role;
      var bubble = '<div class="mental-msg-bubble">' + escapeHtml(m.text) + '</div>';
      if (role === 'assistant') {
        bubble = '<div class="mental-msg-assistant-wrap"><span class="mental-msg-sender">–°–æ–≤–µ—Ç–Ω–∏–∫</span>' + bubble + '</div>';
      }
      return '<div class="mental-msg mental-msg-' + role + '">' + bubble + '</div>';
    }).join('');

    choicesWrap.innerHTML = '';
    replyWrap.style.display = (state.mental.step === 'ask_guiding_reply') ? 'block' : 'none';

    if (state.mental.step === 'welcome' || state.mental.step === 'ask_mood') {
      const moods = [
        { v: 1, l: '–¢—è–∂–µ–ª–æ' },
        { v: 2, l: '–°—Ä–µ–¥–Ω–µ' },
        { v: 3, l: '–ù–æ—Ä–º–∞–ª—å–Ω–æ' },
        { v: 4, l: '–•–æ—Ä–æ—à–æ' },
        { v: 5, l: '–û—Ç–ª–∏—á–Ω–æ' }
      ];
      choicesWrap.innerHTML = moods.map(m => `<button type="button" class="btn btn-ghost mental-choice-btn" data-mood="${m.v}">${m.v} ‚Äî ${m.l}</button>`).join('');
      choicesWrap.style.display = 'flex';
    } else if (state.mental.step === 'ask_factor') {
      choicesWrap.innerHTML = MENTAL_FACTORS.map(f => `<button type="button" class="btn btn-ghost mental-choice-btn" data-factor="${escapeHtml(f.id)}">${escapeHtml(f.label)}</button>`).join('');
      choicesWrap.style.display = 'flex';
    } else if (state.mental.step === 'ask_guiding') {
      var guidingList = getGuidingQuestionsForStep(state.mental.factor, state.mental.mood);
      choicesWrap.innerHTML = guidingList.map(function(q) {
        return '<button type="button" class="btn btn-ghost mental-choice-btn" data-guiding="q" data-question="' + escapeHtml(q).replace(/"/g, '&quot;') + '">' + escapeHtml(q) + '</button>';
      }).join('') + '<button type="button" class="btn btn-primary mental-choice-btn" data-guiding="skip">–°—Ä–∞–∑—É –∫ —Å–æ–≤–µ—Ç–∞–º</button>';
      choicesWrap.style.display = 'flex';
    } else if (state.mental.step === 'ask_guiding_reply') {
      choicesWrap.innerHTML = MENTAL_GUIDING_REPLIES.map(function(r) {
        return '<button type="button" class="btn btn-ghost mental-choice-btn" data-guiding-reply="' + escapeHtml(r).replace(/"/g, '&quot;') + '">' + escapeHtml(r) + '</button>';
      }).join('');
      choicesWrap.style.display = 'flex';
    } else if (state.mental.step === 'advice_done') {
      choicesWrap.innerHTML = '<button type="button" class="btn btn-primary mental-choice-btn" data-action="more">–ü–æ–ª—É—á–∏—Ç—å –µ—â—ë —Å–æ–≤–µ—Ç—ã</button>';
      choicesWrap.style.display = 'flex';
    }

    chat.scrollTop = chat.scrollHeight;
  }

  function onMentalChoice(data) {
    if (data.mood != null) {
      var labels = { 1: '–¢—è–∂–µ–ª–æ', 2: '–°—Ä–µ–¥–Ω–µ', 3: '–ù–æ—Ä–º–∞–ª—å–Ω–æ', 4: '–•–æ—Ä–æ—à–æ', 5: '–û—Ç–ª–∏—á–Ω–æ' };
      state.mental.mood = data.mood;
      addMentalMessage('user', labels[data.mood] || data.mood);
      saveMentalState();
      renderMentalHealth();
      showTypingThenReply(MENTAL_QUESTIONS.factor, 'ask_factor');
    } else if (data.factor) {
      var factorLabel = MENTAL_FACTORS.find(function(f) { return f.id === data.factor; });
      factorLabel = factorLabel ? factorLabel.label : data.factor;
      state.mental.factor = data.factor;
      addMentalMessage('user', factorLabel);
      saveMentalState();
      renderMentalHealth();
      showTypingThenReply(MENTAL_QUESTIONS.guidingIntro, 'ask_guiding');
    } else if (data.guiding === 'skip') {
      addMentalMessage('user', '–°—Ä–∞–∑—É –∫ —Å–æ–≤–µ—Ç–∞–º');
      saveMentalState();
      renderMentalHealth();
      var tips = getMentalAdvice(state.mental.factor, state.mental.mood);
      var text = assistantReplyIntro() + '\n\n' + tips.map(function(t, i) { return (i + 1) + '. ' + t; }).join('\n\n');
      showTypingThenReply(text, 'advice_done');
    } else if (data.guiding === 'q' && data.question) {
      state.mental.guidingQuestion = data.question;
      saveMentalState();
      renderMentalHealth();
      showTypingThenReply(data.question, 'ask_guiding_reply');
    } else if (data['guiding-reply'] != null) {
      addMentalMessage('user', data['guiding-reply']);
      state.mental.guidingQuestion = undefined;
      saveMentalState();
      renderMentalHealth();
      var tips = getMentalAdvice(state.mental.factor, state.mental.mood);
      var text = assistantReplyIntro() + '\n\n' + tips.map(function(t, i) { return (i + 1) + '. ' + t; }).join('\n\n');
      showTypingThenReply(text, 'advice_done');
    } else if (data.action === 'more') {
      addMentalMessage('user', '–ï—â—ë —Å–æ–≤–µ—Ç—ã');
      saveMentalState();
      renderMentalHealth();
      var tipsMore = getMentalAdvice(state.mental.factor, state.mental.mood);
      var textMore = assistantReplyMore() + '\n\n' + tipsMore.map(function(t, i) { return (i + 1) + '. ' + t; }).join('\n\n');
      showTypingThenReply(textMore, 'advice_done');
    }
  }

  function init() {
    loadState();
    loadCharacter();
    loadMentalState();

    document.getElementById('characterForm')?.addEventListener('submit', function(e) { e.preventDefault(); createCharacter(e); });
    document.body.addEventListener('click', function startAdventureClick(e) {
      var t = e.target;
      var btn = t && (t.id === 'btnStartAdventure' ? t : (t.closest && t.closest('#btnStartAdventure')));
      if (btn) {
        e.preventDefault();
        e.stopPropagation();
        createCharacter(e);
      }
    }, true);
    document.getElementById('btnAddHabit')?.addEventListener('click', openAddModal);
    document.getElementById('btnAddReminder')?.addEventListener('click', addReminderRow);
    document.getElementById('habitForm')?.addEventListener('submit', submitHabit);
    document.getElementById('btnCloseModal')?.addEventListener('click', closeModal);
    document.getElementById('btnCancel')?.addEventListener('click', closeModal);
    document.getElementById('btnNotifications')?.addEventListener('click', toggleNotifications);
    document.getElementById('modalOverlay')?.addEventListener('click', e => {
      if (e.target.id === 'modalOverlay') closeModal();
    });
    document.getElementById('mentalSection')?.addEventListener('click', function mentalSectionClick(e) {
      const btn = e.target.closest('.mental-choice-btn');
      if (!btn) return;
      e.preventDefault();
      if (btn.dataset.mood != null) onMentalChoice({ mood: parseInt(btn.dataset.mood, 10) });
      else if (btn.dataset.factor) onMentalChoice({ factor: btn.dataset.factor });
      else if (btn.dataset.action) onMentalChoice({ action: btn.dataset.action });
      else if (btn.dataset.guiding === 'skip') onMentalChoice({ guiding: 'skip' });
      else if (btn.dataset.guiding === 'q' && btn.dataset.question) onMentalChoice({ guiding: 'q', question: btn.dataset.question });
      else if (btn.dataset.guidingReply != null) onMentalChoice({ 'guiding-reply': btn.dataset.guidingReply });
    });
    document.getElementById('mentalSend')?.addEventListener('click', function() {
      var inp = document.getElementById('mentalInput');
      var text = inp && inp.value ? inp.value.trim() : '';
      if (!text) return;
      addMentalMessage('user', text);
      inp.value = '';
      saveMentalState();
      renderMentalHealth();
      if (state.mental.step === 'ask_guiding_reply') {
        state.mental.guidingQuestion = undefined;
        saveMentalState();
        var tips = getMentalAdvice(state.mental.factor || 'general', state.mental.mood);
        var reply = assistantReplyIntro() + '\n\n' + tips.map(function(t, i) { return (i + 1) + '. ' + t; }).join('\n\n');
        showTypingThenReply(reply, 'advice_done');
      } else {
        var tips = getMentalAdvice(state.mental.factor || 'general', state.mental.mood);
        var reply = '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –Ω–∞–ø–∏—Å–∞–ª–∏. ' + assistantReplyIntro() + '\n\n' + tips.map(function(t, i) { return (i + 1) + '. ' + t; }).join('\n\n');
        showTypingThenReply(reply, 'advice_done');
      }
    });

    document.getElementById('feedbackForm')?.addEventListener('submit', function(e) {
      e.preventDefault();
      var section = document.getElementById('feedbackSection');
      var token = (section && section.dataset.feedbackBotToken) ? section.dataset.feedbackBotToken.trim() : '';
      var chatId = (section && section.dataset.feedbackChatId) ? section.dataset.feedbackChatId.trim() : '';
      var nameEl = document.getElementById('feedbackName');
      var msgEl = document.getElementById('feedbackMessage');
      var statusEl = document.getElementById('feedbackStatus');
      var btn = document.getElementById('feedbackSubmitBtn');
      var name = nameEl && nameEl.value ? nameEl.value.trim() : '';
      var message = msgEl && msgEl.value ? msgEl.value.trim() : '';
      if (!message) return;
      if (!token || !chatId) {
        if (statusEl) statusEl.textContent = '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–∏–ª –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram (–Ω—É–∂–Ω—ã data-feedback-bot-token –∏ data-feedback-chat-id).';
        return;
      }
      var text = 'üì¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å ‚Äî Habit Tracker\n\n';
      if (name) text += '–ò–º—è: ' + name + '\n\n';
      text += message;
      text += '\n\n‚Äî –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Habit Tracker';
      if (btn) { btn.disabled = true; btn.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞‚Ä¶'; }
      if (statusEl) statusEl.textContent = '';
      fetch('https://api.telegram.org/bot' + token + '/sendMessage', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          chat_id: chatId,
          text: text,
          disable_web_page_preview: true
        })
      }).then(function(res) { return res.json(); }).then(function(data) {
        if (btn) { btn.disabled = false; btn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram'; }
        if (data.ok) {
          if (msgEl) msgEl.value = '';
          if (nameEl) nameEl.value = '';
          if (statusEl) { statusEl.textContent = '–°–ø–∞—Å–∏–±–æ! –û—Ç–∑—ã–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram.'; statusEl.className = 'feedback-status feedback-status-ok'; }
        } else {
          if (statusEl) { statusEl.textContent = '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å: ' + (data.description || '–æ—à–∏–±–∫–∞').slice(0, 80); statusEl.className = 'feedback-status feedback-status-err'; }
        }
      }).catch(function() {
        if (btn) { btn.disabled = false; btn.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram'; }
        if (statusEl) { statusEl.textContent = '–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.'; statusEl.className = 'feedback-status feedback-status-err'; }
      });
    });

    if (!state.character) {
      showCreateCharacter();
      return;
    }

    showMainApp();
    renderHabits();
    renderDayResults();
    renderCalendar();
    updateChart();
    renderCharacterHeader();
    renderAchievements();
    updateNotificationUI();
    if (state.notificationsEnabled && Notification.permission === 'granted') startNotificationChecks();
    renderMentalHealth();
  }

  init();
})();
